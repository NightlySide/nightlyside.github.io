{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/tipe/2017-12-09-un-probleme-de-route-final","result":{"data":{"site":{"siteMetadata":{"title":"Alexandre Froehlich"}},"markdownRemark":{"id":"03956343-c893-5887-80a6-328afd15afd1","excerpt":"Dernière ligne droite pour le modèle informatique. La dernière étape consiste à implémenter les carrefours, les déviations et les intersections. On se place toujours dans les hypothèses mises en place dans l’explication de la démarche. Mais leur implémentation n’est pas facile à se représenter. Durant la phase de développement, on a fait face à de nombreux problèmes, voici comment on les a résolu. Réécriture des représentations des voitures, chemins et de la grille L’ancienne représentation (à l’aide de tableau) n’est probablement pas la meilleure solution à considérer pour la compréhension et la lisibilité de l’algorithme. Pour cela on utilisera les classes (notion hors programme de PSI en CPGE), pour plus d’information ce cours publié sur OpenClassroom explique mieux ce concept que je ne pourrais le faire. Les voitures Une des raisons pour lesquelles nous allons utiliser les classes est que cela facilite la compréhension. En effet pour récupérer la vitesse d’une voiture avant il fallait récupérer une entrée d’un tableau correspondant à ladite voiture. En utilisant les classes on utilise maintenant la méthode . Ainsi, on crée chaque voiture en lui donnant le nombre d’itérations que la simulation va calculer afin de stocker toutes les positions et vitesses pour les analyser. On lui donne le chemin sur lequel elle va évoluer ainsi que sa position initiale et la vitesse maximale à laquelle et pourra circuler. Le reste sera géré par la simulation. La carte et ses routes De même on retranscrit le code précédent en quelque chose de plus exploitable. En effet, il est plus simple d’écrire  pour modifier la carte en ajoutant une voiture à l’instant t. De même pour les routes : Le problème de l’ancienne simulation L’ancienne simulation fonctionnait bien lorsqu’il n’y avait qu’une seule voiture sur la route. Cependant, la voiture, face à une bifurcation va choisir aléatoirement une route ou l’autre. Nous l’avions codé de cette manière, mais nous voulons que la circulation ne se fasse que dans un sens pour pouvoir analyser la vitesse et la densité des voitures. Problème Pour résoudre ce problème, une solution (celle que j’ai choisi), est de numéroter chaque case de la route, ainsi le sens de circulation sera donné par des indices de case croissants. C’est à dire que le chemin du post précédent devient maintenant : Utilisation du nouveau code Quelques procédures et fonctions bien utiles Depuis le début de ces posts, je vous ai présenté des images, du texte…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/tipe/2017-12-09-un-probleme-de-route-final/#r%C3%A9%C3%A9criture-des-repr%C3%A9sentations-des-voitures-chemins-et-de-la-grille\">Réécriture des représentations des voitures, chemins et de la grille</a></p>\n<ul>\n<li><a href=\"/tipe/2017-12-09-un-probleme-de-route-final/#les-voitures\">Les voitures</a></li>\n<li><a href=\"/tipe/2017-12-09-un-probleme-de-route-final/#la-carte-et-ses-routes\">La carte et ses routes</a></li>\n</ul>\n</li>\n<li><a href=\"/tipe/2017-12-09-un-probleme-de-route-final/#le-probl%C3%A8me-de-lancienne-simulation\">Le problème de l’ancienne simulation</a></li>\n<li>\n<p><a href=\"/tipe/2017-12-09-un-probleme-de-route-final/#utilisation-du-nouveau-code\">Utilisation du nouveau code</a></p>\n<ul>\n<li><a href=\"/tipe/2017-12-09-un-probleme-de-route-final/#quelques-proc%C3%A9dures-et-fonctions-bien-utiles\">Quelques procédures et fonctions bien utiles</a></li>\n<li><a href=\"/tipe/2017-12-09-un-probleme-de-route-final/#cr%C3%A9ation-de-la-simulation\">Création de la simulation</a></li>\n</ul>\n</li>\n<li><a href=\"/tipe/2017-12-09-un-probleme-de-route-final/#lanimation-finale\">L’animation finale</a></li>\n</ul>","timeToRead":6,"html":"<p>Dernière ligne droite pour le modèle informatique. La dernière étape consiste à implémenter les carrefours, les déviations et les intersections. On se place toujours dans les hypothèses mises en place dans l’explication de la démarche. Mais leur implémentation n’est pas facile à se représenter. Durant la phase de développement, on a fait face à de nombreux problèmes, voici comment on les a résolu.</p>\n<h2 id=\"réécriture-des-représentations-des-voitures-chemins-et-de-la-grille\" style=\"position:relative;\"><a href=\"#r%C3%A9%C3%A9criture-des-repr%C3%A9sentations-des-voitures-chemins-et-de-la-grille\" aria-label=\"réécriture des représentations des voitures chemins et de la grille permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Réécriture des représentations des voitures, chemins et de la grille</h2>\n<p>L’ancienne représentation (à l’aide de tableau) n’est probablement pas la meilleure solution à considérer pour la compréhension et la lisibilité de l’algorithme. Pour cela on utilisera les classes (notion hors programme de PSI en CPGE), pour plus d’information <a href=\"https://openclassrooms.com/courses/apprenez-a-programmer-en-python/premiere-approche-des-classes\">ce cours publié sur OpenClassroom</a> explique mieux ce concept que je ne pourrais le faire.</p>\n<h3 id=\"les-voitures\" style=\"position:relative;\"><a href=\"#les-voitures\" aria-label=\"les voitures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Les voitures</h3>\n<p>Une des raisons pour lesquelles nous allons utiliser les classes est que cela facilite la compréhension. En effet pour récupérer la vitesse d’une voiture avant il fallait récupérer une entrée d’un tableau correspondant à ladite voiture. En utilisant les classes on utilise maintenant la méthode <code class=\"language-text\">voiture.getPosition(t)</code>. Ainsi, on crée chaque voiture en lui donnant le nombre d’itérations que la simulation va calculer afin de stocker toutes les positions et vitesses pour les analyser. On lui donne le chemin sur lequel elle va évoluer ainsi que sa position initiale et la vitesse maximale à laquelle et pourra circuler. Le reste sera géré par la simulation.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Voiture</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> nbTemps<span class=\"token punctuation\">,</span> chemin<span class=\"token punctuation\">,</span> carte<span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">,</span> vmax<span class=\"token punctuation\">,</span> facteur<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># On définit les attributs de la voiture</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">setPosition</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">getPosition</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">getVitesse</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">maj_vitesse</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># On adapte ici le code de la simulation précédente</span></code></pre></div>\n<h3 id=\"la-carte-et-ses-routes\" style=\"position:relative;\"><a href=\"#la-carte-et-ses-routes\" aria-label=\"la carte et ses routes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>La carte et ses routes</h3>\n<p>De même on retranscrit le code précédent en quelque chose de plus exploitable. En effet, il est plus simple d’écrire <code class=\"language-text\">carte.placerVoiture(t, voiture)</code> pour modifier la carte en ajoutant une voiture à l’instant <em>t</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Carte</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> hauteur<span class=\"token punctuation\">,</span> largeur<span class=\"token punctuation\">,</span> nbTemps<span class=\"token punctuation\">,</span> aleatoire<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># On définit les attributs de la carte</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">elementALaPosition</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Retourne l'élément de la carte se trouvant à une certaine position</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">creerGrille</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> hauteur<span class=\"token punctuation\">,</span> largeur<span class=\"token punctuation\">,</span> nbTemps<span class=\"token punctuation\">,</span> aleatoire<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># Permet d'initialiser la grille pour la simulation</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">represente</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">,</span> taille<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Retourne une représentation de la carte à l'instant t</span>\n        <span class=\"token comment\"># Et ce, taille fois plus grand</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">placerVoiture</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">,</span> voiture<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">placerRoute</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> route<span class=\"token punctuation\">)</span></code></pre></div>\n<p>De même pour les routes :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Chemin</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> carte<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>positions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># On initialise la route à partir des positions par lesquelles</span>\n        <span class=\"token comment\"># elle passera</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">creerCheminSimple</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pos_i<span class=\"token punctuation\">,</span> pos_f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Permet de créer un chemin simple entre 2 points</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">creerCheminComplexe</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>positions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Permet de créer un chemin complexe passant par un ensemble de positions</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">additionneChemins</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Permet d'additionner le chemin c à l'actuel</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">estSurChemin</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Vérifie si une position se trouve sur le chemin</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">voisins</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">voisin_suivant</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">distance</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pos1<span class=\"token punctuation\">,</span> pos2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Retourner la distance en nombre de cases entre les deux positions</span></code></pre></div>\n<h2 id=\"le-problème-de-lancienne-simulation\" style=\"position:relative;\"><a href=\"#le-probl%C3%A8me-de-lancienne-simulation\" aria-label=\"le problème de lancienne simulation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le problème de l’ancienne simulation</h2>\n<p>L’ancienne simulation fonctionnait bien lorsqu’il n’y avait qu’une seule voiture sur la route. Cependant, la voiture, face à une bifurcation va choisir aléatoirement une route ou l’autre. Nous l’avions codé de cette manière, mais nous voulons que la circulation ne se fasse que dans un sens pour pouvoir analyser la vitesse et la densité des voitures.</p>\n<p><img src=\"/66913d33f5c45d396925f4c9bcba46b6/probleme.gif\" alt=\"Problème\"></p>\n<p>Pour résoudre ce problème, une solution (celle que j’ai choisi), est de numéroter chaque case de la route, ainsi le sens de circulation sera donné par des indices de case croissants. C’est à dire que le chemin du post précédent devient maintenant :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">chemin <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"utilisation-du-nouveau-code\" style=\"position:relative;\"><a href=\"#utilisation-du-nouveau-code\" aria-label=\"utilisation du nouveau code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Utilisation du nouveau code</h2>\n<h3 id=\"quelques-procédures-et-fonctions-bien-utiles\" style=\"position:relative;\"><a href=\"#quelques-proc%C3%A9dures-et-fonctions-bien-utiles\" aria-label=\"quelques procédures et fonctions bien utiles permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Quelques procédures et fonctions bien utiles</h3>\n<p>Depuis le début de ces posts, je vous ai présenté des images, du texte, correspondant au résultats des simulations mais je ne vous ai pas encore expliqué comment cela se fait. Voici quelques fonctions bien utiles que j’ai utilisé entre autre afin d’exporter la carte à un instant donné, comment j’ai transformé une vitesse en cases par unité de temps en km/h, etc.</p>\n<p>La fonction suivante permet de récupérer une distance cartésienne entre deux points (il s’agit de la norme de la distance à ces points).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">distancePos</span><span class=\"token punctuation\">(</span>pos_i<span class=\"token punctuation\">,</span> pos_f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    x<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> pos_i\n    i<span class=\"token punctuation\">,</span> j <span class=\"token operator\">=</span> pos_f\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">-</span> i<span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">-</span> j<span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Voici une autre fonction très utile que je traîne avec moi depuis quelques années et qui me sert pour numéroter des images d’une simulation afin qu’elles soient acceptée par certains logiciels. Elle permet entre autre de transformer <code class=\"language-text\">98</code> et <code class=\"language-text\">6</code> en <code class=\"language-text\">00098</code> et <code class=\"language-text\">00006</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">ajoutezeros</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> nombrezeros<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Prends le nombre n et rajoute le nombre de zéros nécessaires\n    à sa représentation en chaine de charactère\n    Retourne une chaine de charactères\n    ex : on veut un nombre à 3 chiffres : ajoutezeros(3, 5) = \"003\"\n    \"\"\"</span>\n    nb <span class=\"token operator\">=</span> nombrezeros<span class=\"token operator\">-</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> nb <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"0\"</span><span class=\"token operator\">*</span>nb<span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Le code suivant permet d’afficher la carte à l’instant t. J’ai décidé de laisser tomber matplotlib pour pylab qui à l’avantage de supporter un rafraîchissement de l’image plus fréquent (et par conséquent le support des animations).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">affiche_grille</span><span class=\"token punctuation\">(</span>carte<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    pylab<span class=\"token punctuation\">.</span>ion<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    tabplot <span class=\"token operator\">=</span> pylab<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>carte<span class=\"token punctuation\">.</span>represente<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> taille<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \\\n                    cmap<span class=\"token operator\">=</span>matplotlib<span class=\"token punctuation\">.</span>colors<span class=\"token punctuation\">.</span>ListedColormap<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'white'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'palegreen'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'antiquewhite'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Voici une des plus grandes avancées de mon code depuis la première version (en linéaire) il sert à jouer l’animation sans pour autant l’exporter en fichiers. Cela reste plutôt lent et le paramètre qui permet de contrôle le nombre d’images par secondes (FPS en anglais) est homéopathique.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">affiche_simulation</span><span class=\"token punctuation\">(</span>carte<span class=\"token punctuation\">,</span> fps<span class=\"token operator\">=</span><span class=\"token number\">25</span><span class=\"token punctuation\">,</span> tmin<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> tmax<span class=\"token operator\">=</span>nbTemps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    pylab<span class=\"token punctuation\">.</span>ion<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    tabplot <span class=\"token operator\">=</span> pylab<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>carte<span class=\"token punctuation\">.</span>represente<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> taille<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \\\n        cmap<span class=\"token operator\">=</span>matplotlib<span class=\"token punctuation\">.</span>colors<span class=\"token punctuation\">.</span>ListedColormap<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'white'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'palegreen'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'antiquewhite'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> t <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>tmin<span class=\"token punctuation\">,</span> tmax<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        tabplot<span class=\"token punctuation\">.</span>set_data<span class=\"token punctuation\">(</span>carte<span class=\"token punctuation\">.</span>represente<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> taille<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        pylab<span class=\"token punctuation\">.</span>draw<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        xx <span class=\"token operator\">=</span> pylab<span class=\"token punctuation\">.</span>waitforbuttonpress<span class=\"token punctuation\">(</span>timeout<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">/</span>fps<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"création-de-la-simulation\" style=\"position:relative;\"><a href=\"#cr%C3%A9ation-de-la-simulation\" aria-label=\"création de la simulation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Création de la simulation</h3>\n<p>Le code précédent s’est bien raccourci grâce aux classes et possède une certaine compréhension quand à son initialisation.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># on crée la carte</span>\ncarte <span class=\"token operator\">=</span> Carte<span class=\"token punctuation\">(</span>W<span class=\"token punctuation\">,</span> H<span class=\"token punctuation\">,</span> nbTemps<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># on crée la route</span>\nroute <span class=\"token operator\">=</span> Chemin<span class=\"token punctuation\">(</span>carte<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">54</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">54</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># on crée la seconde route</span>\nroute2 <span class=\"token operator\">=</span> Chemin<span class=\"token punctuation\">(</span>carte<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">54</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">54</span><span class=\"token punctuation\">,</span> <span class=\"token number\">29</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">29</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">54</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># on indique l'endroit où les routes vont se rejoindre</span>\nroute<span class=\"token punctuation\">.</span>deviation<span class=\"token punctuation\">(</span>route2<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">54</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># On place la route</span>\ncarte<span class=\"token punctuation\">.</span>placerChemin<span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">)</span></code></pre></div>\n<p>On a ainsi crée la carte sur laquelle la simulation va se dérouler, crée la route principale avec une déviation. Maintenant on doit crée les voitures. Pour se faire rien de plus simple on utilise la classe du dessus pour crée autant d’instances que de voitures. On utilise le code suivant, notez bien la structure particulière qui est presque transparente.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">voitures <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>nbVoitures<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    voiture <span class=\"token operator\">=</span> Voiture<span class=\"token punctuation\">(</span>nbTemps<span class=\"token punctuation\">,</span> route<span class=\"token punctuation\">,</span> carte<span class=\"token punctuation\">,</span> vitessemax<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> p<span class=\"token operator\">=</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    voitures<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>voiture<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># On place la voiture</span>\n    voiture<span class=\"token punctuation\">.</span>setPosition<span class=\"token punctuation\">(</span>t<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">)</span>\n    carte<span class=\"token punctuation\">.</span>placerVoiture<span class=\"token punctuation\">(</span>t<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> voiture<span class=\"token punctuation\">)</span></code></pre></div>\n<p>On vient de créer toutes les voitures et on les a placées à leur première position c’est à dire pour à <span class=\"mjx-chtml\"><span class=\"mjx-math\" aria-label=\"t=0\"><span class=\"mjx-mrow\" aria-hidden=\"true\"><span class=\"mjx-mi\"><span class=\"mjx-char MJXc-TeX-math-I\" style=\"padding-top: 0.372em; padding-bottom: 0.298em;\">t</span></span><span class=\"mjx-mo MJXc-space3\"><span class=\"mjx-char MJXc-TeX-main-R\" style=\"padding-top: 0.077em; padding-bottom: 0.298em;\">=</span></span><span class=\"mjx-mn MJXc-space3\"><span class=\"mjx-char MJXc-TeX-main-R\" style=\"padding-top: 0.372em; padding-bottom: 0.372em;\">0</span></span></span></span></span>. Il ne reste plus qu’à calculer la vitesse de chaque voiture pour chaque temps et les déplacer en conséquence. On commence à <span class=\"mjx-chtml\"><span class=\"mjx-math\" aria-label=\"t=1\"><span class=\"mjx-mrow\" aria-hidden=\"true\"><span class=\"mjx-mi\"><span class=\"mjx-char MJXc-TeX-math-I\" style=\"padding-top: 0.372em; padding-bottom: 0.298em;\">t</span></span><span class=\"mjx-mo MJXc-space3\"><span class=\"mjx-char MJXc-TeX-main-R\" style=\"padding-top: 0.077em; padding-bottom: 0.298em;\">=</span></span><span class=\"mjx-mn MJXc-space3\"><span class=\"mjx-char MJXc-TeX-main-R\" style=\"padding-top: 0.372em; padding-bottom: 0.372em;\">1</span></span></span></span></span> puisque la situation initiale à déjà été définie.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">for</span> t <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> nbTemps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Pour chacune des voitures</span>\n    <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>voitures<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># On fait avancer les voitures et on change leur vitesse</span>\n        voitures<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>setPosition<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> voitures<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>avance<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> voitures<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>getPosition<span class=\"token punctuation\">(</span>t<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> voitures<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>vitesse<span class=\"token punctuation\">[</span>t<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        voitures<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>maj_vitesse<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># On replace la voiture sur la grille de l'instant t</span>\n        carte<span class=\"token punctuation\">.</span>placerVoiture<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> voitures<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"lanimation-finale\" style=\"position:relative;\"><a href=\"#lanimation-finale\" aria-label=\"lanimation finale permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>L’animation finale</h2>\n<p>Ça y est ! On touche à la fin. Normalement tout fonctionne maintenant et on se retrouve avec une carte contenant la position de toutes les voitures à tout instant de la simulation. Il ne reste plus qu’à traiter ce tableau afin d’afficher la simulation. On obtient finalement quelque chose qui ressemble à l’animation ci-dessous.</p>\n<p><img src=\"/e121b6dbf94ced15f29b4424b6d26520/anim_finale.gif\" alt=\"Problème\"></p>\n<p>Le modèle informatique est dès à présent terminé. La prochaine étape consiste à construire une maquette modélisant la circulation et de tout comparer à la réalité.</p>","frontmatter":{"date":"December 09, 2017","title":"[TIPE] Un problème de route - Le final (4/4)","slug":null,"tags":["python","TIPE","route"],"layout":"post","published":true,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3wUH/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABPyFf/9oADAMBAAIAAwAAABDwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABgQAAIDAAAAAAAAAAAAAAAAAAABEDFB/9oACAEBAAE/EHRkOjI//9k=","aspectRatio":2,"src":"/static/8cda092e637b2d3c233ce8006e44505a/14b42/final_front.jpg","srcSet":"/static/8cda092e637b2d3c233ce8006e44505a/f836f/final_front.jpg 200w,\n/static/8cda092e637b2d3c233ce8006e44505a/2244e/final_front.jpg 400w,\n/static/8cda092e637b2d3c233ce8006e44505a/14b42/final_front.jpg 800w,\n/static/8cda092e637b2d3c233ce8006e44505a/47498/final_front.jpg 1200w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"headings":[{"value":"Réécriture des représentations des voitures, chemins et de la grille","depth":2,"id":"réécriture-des-représentations-des-voitures-chemins-et-de-la-grille"},{"value":"Les voitures","depth":3,"id":"les-voitures"},{"value":"La carte et ses routes","depth":3,"id":"la-carte-et-ses-routes"},{"value":"Le problème de l’ancienne simulation","depth":2,"id":"le-problème-de-lancienne-simulation"},{"value":"Utilisation du nouveau code","depth":2,"id":"utilisation-du-nouveau-code"},{"value":"Quelques procédures et fonctions bien utiles","depth":3,"id":"quelques-procédures-et-fonctions-bien-utiles"},{"value":"Création de la simulation","depth":3,"id":"création-de-la-simulation"},{"value":"L’animation finale","depth":2,"id":"lanimation-finale"}]}},"pageContext":{"slug":"tipe/2017-12-09-un-probleme-de-route-final","previous":{"fields":{"slug":"tipe/2017-12-02-un-probleme-de-route-passage-2D"},"frontmatter":{"tags":["python","TIPE","route"],"title":"[TIPE] Un problème de route - Passage en 2D (3/4)","date":"2017-12-02T12:00:00.000Z","slug":null,"layout":"post","published":true}},"next":{"fields":{"slug":"tipe/2018-03-21-un-probleme-de-route-bonus"},"frontmatter":{"tags":["python","TIPE","route"],"title":"[TIPE] Un problème de route - Bonus","date":"2018-03-21T12:00:00.000Z","slug":null,"layout":"post","published":true}}}},"staticQueryHashes":["3433897746","712016698","781468736"]}
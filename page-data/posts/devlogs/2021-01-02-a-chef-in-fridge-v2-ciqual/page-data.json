{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual","result":{"data":{"site":{"siteMetadata":{"title":"Alexandre Froehlich"}},"markdownRemark":{"id":"21ac83f0-d445-5652-a6dd-c17aea8abc5a","excerpt":"Dans ma précédente itération du projet ”A Chef in the Fridge” l’utilisateur devait rentrer manuellement le nom et le type des ingrédients que sa recette utilise. Alors non seulement cela était très lourd pour l’utilisateur, surtout en ce qui concerne la recherche des informations sur la composition des ingrédients. Nous allons voir comment automatiser tout ça dans ce post. Le jeu de données Ciqual Pour commencer il nous faut une source de données à partir de laquelle on va baser toute notre optimisation. En cherchant sur le site data.gouv.fr je suis tombé sur la ”Table de composition nutritionnelle des aliments Ciqual“. Qu’est-ce que Ciqual ? Il s’agit d’une table recensant près de 2800 aliments, crée par l’ANSES (Agence Nationale de SÉcurité Sanitaire, alimentation, environnement, travail). On peut retrouver dans cette tables des aliments ainsi que leur composition. Et tout ça en source ouverte ! Les données fournies par Ciqual se décompose en 5 fichiers :  : données des aliments  : données des groupes alimentaires  : constantes pour la composition (glucides, énergie, …)  : données de la composition des aliments  : sources des données de composition de chaque aliment Pour comprendre comment sont stockées ces données, Ciqual met à disposition une documentation plutôt détaillée. Format des données Avant de pouvoir utiliser ces données il est intéressant de jeter un oeil à la façon dont elles sont enregistrées. Par exemple un aliment ressemble à la structure suivante : Une composition d’une constante pour un ingrédient donné ressemble à la structure suivante : Il est évident que l’on ne peut pas utiliser les données telles quelles. De plus essayer de charger complètement les 2800 aliments avec une vingtaine de compositions différentes devient très lourd en mémoire (près de 800Mo de RAM utilisée pour un programme rédigé avec Python). La solution pour résoudre ces deux problèmes ? Une base de données relationnelle. On va donc ici aussi utiliser une base de données spécifiquement pour les ingrédients. La base de données Création de la bdd Pour cette base de données je vais utiliser une fois de plus SQLite avec pour ORM SQLAlchemy. Pour rappel un ORM est : “un type de programme informatique qui se place en interface entre un programme applicatif et une base de données relationnelle pour simuler une base de données orientée objet” — Wikipedia  On peut alors avec python créer une base de données (fichier ) et l’initialiser simplement avec le code suivant : Vous…","tableOfContents":"<ul>\n<li><a href=\"/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual/#le-jeu-de-donn%C3%A9es-ciqual\">Le jeu de données Ciqual</a></li>\n<li><a href=\"/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual/#format-des-donn%C3%A9es\">Format des données</a></li>\n<li>\n<p><a href=\"/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual/#la-base-de-donn%C3%A9es\">La base de données</a></p>\n<ul>\n<li><a href=\"/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual/#cr%C3%A9ation-de-la-bdd\">Création de la bdd</a></li>\n<li><a href=\"/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual/#cr%C3%A9ation-des-mod%C3%A8les\">Création des modèles</a></li>\n<li><a href=\"/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual/#ins%C3%A9rer-des-donn%C3%A9es-dans-la-bdd\">Insérer des données dans la BDD</a></li>\n<li><a href=\"/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual/#r%C3%A9cup%C3%A9rer-les-donn%C3%A9es\">Récupérer les données</a></li>\n</ul>\n</li>\n<li><a href=\"/devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual/#conclusion\">Conclusion</a></li>\n</ul>","timeToRead":8,"html":"<p>Dans ma précédente itération du projet ”<em>A Chef in the Fridge</em>” l’utilisateur devait rentrer manuellement le nom et le type des ingrédients que sa recette utilise. Alors non seulement cela était très lourd pour l’utilisateur, surtout en ce qui concerne la recherche des informations sur la composition des ingrédients.</p>\n<p>Nous allons voir comment automatiser tout ça dans ce post.</p>\n<h2 id=\"le-jeu-de-données-ciqual\" style=\"position:relative;\"><a href=\"#le-jeu-de-donn%C3%A9es-ciqual\" aria-label=\"le jeu de données ciqual permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le jeu de données Ciqual</h2>\n<p>Pour commencer il nous faut une <strong>source de données</strong> à partir de laquelle on va baser toute notre optimisation. En cherchant sur le site <a href=\"https://www.data.gouv.fr/fr/\">data.gouv.fr</a> je suis tombé sur la ”<a href=\"https://www.data.gouv.fr/fr/datasets/table-de-composition-nutritionnelle-des-aliments-ciqual/\">Table de composition nutritionnelle des aliments Ciqual</a>“.</p>\n<p>Qu’est-ce que <strong>Ciqual</strong> ? Il s’agit d’une table recensant près de 2800 aliments, crée par l’<a href=\"https://www.anses.fr/fr\">ANSES</a> (Agence Nationale de SÉcurité Sanitaire, alimentation, environnement, travail). On peut retrouver dans cette tables des aliments ainsi que leur composition. Et tout ça en source ouverte !</p>\n<p>Les données fournies par Ciqual se décompose en 5 fichiers :</p>\n<ul>\n<li><code class=\"language-text\">alim_2020_07_07.xml</code> : données des aliments</li>\n<li><code class=\"language-text\">alim_grp_2020_07_07.xml</code> : données des groupes alimentaires</li>\n<li><code class=\"language-text\">const_2020_07_07.xml</code> : constantes pour la composition (glucides, énergie, …)</li>\n<li><code class=\"language-text\">compo_2020_07_07.xml</code> : données de la composition des aliments</li>\n<li><code class=\"language-text\">sources_2020_07_07.xml</code> : sources des données de composition de chaque aliment</li>\n</ul>\n<p>Pour comprendre comment sont stockées ces données, Ciqual met à disposition <a href=\"https://ciqual.anses.fr/cms/sites/default/files/inline-files/Table%20Ciqual%202020_doc_XML_FR_2020%2007%2007.pdf\">une documentation</a> plutôt détaillée.</p>\n<h2 id=\"format-des-données\" style=\"position:relative;\"><a href=\"#format-des-donn%C3%A9es\" aria-label=\"format des données permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Format des données</h2>\n<p>Avant de pouvoir utiliser ces données il est intéressant de jeter un oeil à la façon dont elles sont enregistrées.</p>\n<p>Par exemple un aliment ressemble à la structure suivante :</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ALIM</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alim_code</span><span class=\"token punctuation\">></span></span> 2016 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alim_code</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alim_nom_fr</span><span class=\"token punctuation\">></span></span> Jus de raisin, pur jus <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alim_nom_fr</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ALIM_NOM_INDEX_FR</span><span class=\"token punctuation\">></span></span> Jus de raisin <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ALIM_NOM_INDEX_FR</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alim_nom_eng</span><span class=\"token punctuation\">></span></span> Grape juice, pure juice <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alim_nom_eng</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alim_grp_code</span><span class=\"token punctuation\">></span></span> 06 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alim_grp_code</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alim_ssgrp_code</span><span class=\"token punctuation\">></span></span> 0602 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alim_ssgrp_code</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alim_ssssgrp_code</span><span class=\"token punctuation\">></span></span> 060201 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alim_ssssgrp_code</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ALIM</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Une composition d’une constante pour un ingrédient donné ressemble à la structure suivante :</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>COMPO</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alim_code</span><span class=\"token punctuation\">></span></span> 1003 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alim_code</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>const_code</span><span class=\"token punctuation\">></span></span> 333 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>const_code</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>teneur</span><span class=\"token punctuation\">></span></span> 328 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>teneur</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>min</span> <span class=\"token attr-name\">missing</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span> <span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>max</span> <span class=\"token attr-name\">missing</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span> <span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>code_confiance</span><span class=\"token punctuation\">></span></span> C <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>code_confiance</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source_code</span><span class=\"token punctuation\">></span></span> 147 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>source_code</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>COMPO</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Il est évident que l’on ne peut pas utiliser les données telles quelles. De plus essayer de charger complètement les 2800 aliments avec une vingtaine de compositions différentes devient très lourd en mémoire (près de 800Mo de RAM utilisée pour un programme rédigé avec Python).</p>\n<p>La solution pour résoudre ces deux problèmes ? Une <strong>base de données relationnelle</strong>. On va donc ici aussi utiliser une base de données spécifiquement pour les ingrédients.</p>\n<h2 id=\"la-base-de-données\" style=\"position:relative;\"><a href=\"#la-base-de-donn%C3%A9es\" aria-label=\"la base de données permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>La base de données</h2>\n<h3 id=\"création-de-la-bdd\" style=\"position:relative;\"><a href=\"#cr%C3%A9ation-de-la-bdd\" aria-label=\"création de la bdd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Création de la bdd</h3>\n<p>Pour cette base de données je vais utiliser une fois de plus <strong>SQLite</strong> avec pour ORM <a href=\"https://www.sqlalchemy.org/\">SQLAlchemy</a>.</p>\n<blockquote>\n<p>Pour rappel un ORM est : “un type de programme informatique qui se place en interface entre un programme applicatif et une base de données relationnelle pour simuler une base de données orientée objet” — <a href=\"https://fr.wikipedia.org/wiki/Mapping_objet-relationnel\">Wikipedia</a></p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 876px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABWklEQVQoz41SzUsCQRydP7FLf4GHDnlI6tDHIXc32DI0EvzowwhS9KgHEfPUqVuQLNqsi0pGRZcoyk2d2deM7UiGQj9483szy3vL/N4QzjkYY5BdcQnPg4AHT3BVcq/6PBDMK188pvInw8GYczaaGM8qYlkW8vk8bNtGuVxGpVJBqVjEgHsYPvXwZt3g9foKLwKDx3t0jqOQduzjHSMB1v8E/3IxcvtgrguiaRpM00QwGITjOIjFYjB0HVyIurkTWEuLeC5k0NheQSe1j9vAAlrmOqi5AaqF0NxaBhXfbH0V3aMoSDabRTqdRq1Wg2EYuKxWEU8kUMpdgOZO8VA4w11YCHY30c7E4ST30AyHYB/uwElF0DrQxVkEjbUAOueJnxmqmVBKx8b1en1qTlx1GZaaqw9ZQ3HttjDrlQogSigTnp0mnzrz45/Oz9fKlfyOXJr+52n8xcRU8G/dK0VTLyxMnwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SQLAlchemy logo\"\n        title=\"SQLAlchemy logo\"\n        src=\"/static/fffbe7fdc02b94d00096ce7d046603c1/1b1d5/sqlalchemy.png\"\n        srcset=\"/static/fffbe7fdc02b94d00096ce7d046603c1/72799/sqlalchemy.png 320w,\n/static/fffbe7fdc02b94d00096ce7d046603c1/6af66/sqlalchemy.png 640w,\n/static/fffbe7fdc02b94d00096ce7d046603c1/1b1d5/sqlalchemy.png 876w\"\n        sizes=\"(max-width: 876px) 100vw, 876px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>On peut alors avec python créer une base de données (fichier <code class=\"language-text\">data.db</code>) et l’initialiser simplement avec le code suivant :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># database.py</span>\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> scoped_session<span class=\"token punctuation\">,</span> sessionmaker\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\n<span class=\"token comment\"># création du moteur, ici on utilise SQLite</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span><span class=\"token string\">'sqlite:///data.db'</span><span class=\"token punctuation\">,</span> convert_unicode<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\ndb_session <span class=\"token operator\">=</span> scoped_session<span class=\"token punctuation\">(</span>sessionmaker<span class=\"token punctuation\">(</span>autocommit<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n                                         autoflush<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n                                         bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nBase<span class=\"token punctuation\">.</span>query <span class=\"token operator\">=</span> db_session<span class=\"token punctuation\">.</span>query_property<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">init_db</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># on va importer tous les modèles</span>\n    <span class=\"token comment\"># pour que SQLAlchemy puisse créer toutes les tables</span>\n    <span class=\"token comment\"># et se connecter aux données</span>\n    <span class=\"token keyword\">import</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    Base<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Vous avez peut être remarqué que j’ai laissé l’import vide et c’est normal. Je dois d’abord créer le modèle correspondant aux données.</p>\n<h3 id=\"création-des-modèles\" style=\"position:relative;\"><a href=\"#cr%C3%A9ation-des-mod%C3%A8les\" aria-label=\"création des modèles permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Création des modèles</h3>\n<p>On a 4 modèles à créer et je vais expliquer uniquement l’un d’entres eux (le reste étant équivalent).</p>\n<p>Les 4 modèles de données sont :</p>\n<ul>\n<li><code class=\"language-text\">Alim</code> : les aliments</li>\n<li><code class=\"language-text\">AlimGroup</code> : les groupes d’aliments</li>\n<li><code class=\"language-text\">Const</code> : les constantes de compositions alimentaire</li>\n<li><code class=\"language-text\">Compo</code> : les compositions alimentaire</li>\n</ul>\n<p>Pour créer un modèle il faut créer une classe héritant de <code class=\"language-text\">Base</code> qui est notre modèle déclaratif de BDD. On spécifie ensuite sont nom de table dans <code class=\"language-text\">__tablename__</code> puis on décrit la structure de la table avec des <code class=\"language-text\">Column()</code>. SQLAlchemy se chargera de tout traduire en code SQL pour l’initialisation et les requêtes.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># const.py</span>\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> String\n<span class=\"token keyword\">from</span> database <span class=\"token keyword\">import</span> Base\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Const</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">\"consts\"</span>\n    code <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    nom_fr <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    nom_eng <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> code<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> nom_fr<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> nom_eng<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> code\n        self<span class=\"token punctuation\">.</span>nom_fr <span class=\"token operator\">=</span> nom_fr\n        self<span class=\"token punctuation\">.</span>nom_eng <span class=\"token operator\">=</span> nom_eng\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__repr__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        res <span class=\"token operator\">=</span> <span class=\"token string\">\"===CONST===\\n\"</span>\n        res <span class=\"token operator\">+=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"Code: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">}</span></span><span class=\"token string\">\\n\"</span></span>\n        res <span class=\"token operator\">+=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"Nom fr: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>nom_fr<span class=\"token punctuation\">}</span></span><span class=\"token string\">\\n\"</span></span>\n        res <span class=\"token operator\">+=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"Nom eng: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>nom_eng<span class=\"token punctuation\">}</span></span><span class=\"token string\">\\n\"</span></span>\n\n        <span class=\"token keyword\">return</span> res</code></pre></div>\n<p>Ainsi on va pouvoir créer une table “consts” avec une colonne contenant le code de la constante, une chaine de caractères pour son nom en français et une pour son nom en anglais.</p>\n<h3 id=\"insérer-des-données-dans-la-bdd\" style=\"position:relative;\"><a href=\"#ins%C3%A9rer-des-donn%C3%A9es-dans-la-bdd\" aria-label=\"insérer des données dans la bdd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Insérer des données dans la BDD</h3>\n<p>On a maintenant une structure fonctionnellement mais vide de données, on va la remplir à partir des fichiers XML fournis par Ciqual.</p>\n<p>Par exemple pour les constantes on va faire (une fois de plus le code est équivalent pour les 3 autres types de donnée) :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> xml<span class=\"token punctuation\">.</span>etree<span class=\"token punctuation\">.</span>ElementTree <span class=\"token keyword\">import</span> Element\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_constants</span><span class=\"token punctuation\">(</span>filename<span class=\"token operator\">=</span><span class=\"token string\">\"const_2020_07_07.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    root <span class=\"token operator\">=</span> ET<span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getroot<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> element <span class=\"token keyword\">in</span> root<span class=\"token punctuation\">.</span>findall<span class=\"token punctuation\">(</span><span class=\"token string\">\"CONST\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        res<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>const_from_xml<span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> res\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">const_from_xml</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">:</span> Element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    const <span class=\"token operator\">=</span> Const<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    const<span class=\"token punctuation\">.</span>code <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"const_code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    const<span class=\"token punctuation\">.</span>nom_fr <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"const_nom_fr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    const<span class=\"token punctuation\">.</span>nom_eng <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"const_nom_eng\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> const</code></pre></div>\n<p>On peut maintenant récupérer une liste d’objets correspondant aux constantes et dans un format qui est compréhensible par l’ORM. Il ne reste plus qu’à l’ajouter à la base de données. On peut ajouter comme vérification le fait que la base de données soit vide ou non pour la remplir ou non (le chargement des données étant relativement gourmand en resources et en temps).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> database <span class=\"token keyword\">import</span> db_session\n\n<span class=\"token comment\"># on ajoute les constantes à la requête SQL</span>\ndb_session<span class=\"token punctuation\">.</span>add_all<span class=\"token punctuation\">(</span>get_constants<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># on applique les modifications à la base de données</span>\ndb_session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"récupérer-les-données\" style=\"position:relative;\"><a href=\"#r%C3%A9cup%C3%A9rer-les-donn%C3%A9es\" aria-label=\"récupérer les données permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Récupérer les données</h3>\n<p>Tout est en ordre, on a une base de données configurée pour contenir les informations qui nous intéressent. Il ne reste plus qu’à les extraires pour afficher les informations d’un ingrédient.</p>\n<p>Pour récupérer une donnée avec SQLAlchemy, on utilise l’attribut <code class=\"language-text\">query</code> du modèle qui nous intéresse. Par exemple pour récupérer une constante contenant le mot énergie :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">Const<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>Const<span class=\"token punctuation\">.</span>nom_fr<span class=\"token punctuation\">.</span>like<span class=\"token punctuation\">(</span><span class=\"token string\">\"%énergie%\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Dans l’ordre, on va filtrer la base de données. Le paramètre de filtration est la colonne <code class=\"language-text\">nom_fr</code> et nous allons chercher les occurences semblables au mot “énergie” (comme <code class=\"language-text\">LIKE</code> en SQL). Enfin on va récupérer le premier élément de cette recherche (pour tous les récupérer on peut utilise <code class=\"language-text\">.all()</code>).</p>\n<p>Je peux maintenant construire une fonction étant donné un aliment en entrée (récupéré avec une fonction de recherche par exemple) :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_ingredient_details</span><span class=\"token punctuation\">(</span>aliment<span class=\"token punctuation\">:</span> Alim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  code_alim <span class=\"token operator\">=</span> aliment<span class=\"token punctuation\">.</span>code\n\n  <span class=\"token comment\"># on récupère le groupe de l'aliment</span>\n  groupe <span class=\"token operator\">=</span> AlimGroup<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>AlimGroup<span class=\"token punctuation\">.</span>group_code <span class=\"token operator\">==</span> ing<span class=\"token punctuation\">.</span>groupe_code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\"># on récupère toutes les compositions de l'ingrédient</span>\n  compositions <span class=\"token operator\">=</span> Compo<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>Compo<span class=\"token punctuation\">.</span>alim_code <span class=\"token operator\">==</span> code_alim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\"># pour chacune des compositions on récupère la constante associée</span>\n  constantes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>Const<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>Const<span class=\"token punctuation\">.</span>code <span class=\"token operator\">==</span> compo<span class=\"token punctuation\">.</span>const_code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> compo <span class=\"token keyword\">in</span> compositions<span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\"># on va créer un objet JSON contenant toutes ces données</span>\n  compo_json <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> \\\n    <span class=\"token string\">\"code\"</span><span class=\"token punctuation\">:</span> consts<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">,</span> \\\n    constantes<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>nom_fr<span class=\"token punctuation\">:</span> compositions<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>teneur<span class=\"token punctuation\">,</span> \\\n    <span class=\"token string\">\"confiance\"</span><span class=\"token punctuation\">:</span> compos<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>code_confiance<span class=\"token punctuation\">}</span> <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>compos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"ingredient\"</span><span class=\"token punctuation\">:</span> aliment<span class=\"token punctuation\">,</span> <span class=\"token string\">\"groupe\"</span><span class=\"token punctuation\">:</span> groupe<span class=\"token punctuation\">,</span> <span class=\"token string\">\"composition\"</span><span class=\"token punctuation\">:</span> compo_json<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ainsi pour un ingrédient comme des carottes pour exemple, on obtient une sortie ressemblant à ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"ingredient\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20307</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"nom_fr\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Carotte, cuite à la vapeur\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"nom_index_fr\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Carotte\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"nom_eng\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Carrot, steamed\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"groupe_code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ssgroupe_code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">201</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ssssgroupe_code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20102</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"groupe\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"group_code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"group_nom_fr\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fruits, légumes, légumineuses et oléagineux\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"group_nom_eng\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fruits, vegetables, legumes and nuts\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ssgroup_code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">201</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ssgroup_nom_fr\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fruits, légumes, légumineuses et oléagineux\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ssgroup_nom_eng\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fruits, vegetables, legumes and nuts\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ssssgroup_code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">201</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ssssgroup_nom_fr\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fruits, légumes, légumineuses et oléagineux\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ssssgroup_nom_eng\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fruits, vegetables, legumes and nuts\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"composition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">327</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Energie, Règlement UE N° 1169/2011 (kJ/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"175\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">328</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Energie, Règlement UE N° 1169/2011 (kcal/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"41,6\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">332</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Energie, N x facteur Jones, avec fibres  (kJ/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"175\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">333</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Energie, N x facteur Jones, avec fibres  (kcal/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"41,6\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Eau (g/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"87,7\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Cendres (g/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0,63\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10004</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Sel chlorure de sodium (g/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0,11\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10110</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Sodium (mg/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"45\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10120</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Magnésium (mg/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10150</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Phosphore (mg/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"19\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"B\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10170</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Chlorure (mg/100 g)\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"76,1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"confiance\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        ...\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>J’ai coupé la fin du fichier, en effet la table Ciqual possède beaucoup d’indicateurs.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>La table d’informations nutritionnelles Ciqual est vraiment impressionnante par le nombre d’aliments recensés et par sa qualité.</p>\n<p>Je suis maintenant en mesure d’indiquer automatiquement les valeurs nutritionnelles d’un aliment à partir de son nom ou de son code. Ça me sera grandement utile dans la nouvelle itération de mon projet ”<em>A Chef in the Fridge</em>“.</p>","frontmatter":{"date":"January 02, 2021","title":"Composition des ingrédients avec les données Ciqual","slug":null,"tags":["python","sql","xml","data"],"layout":"post","published":true,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAC/8QAFAEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABTlmQjyZH/8QAFxABAQEBAAAAAAAAAAAAAAAAAgEAMv/aAAgBAQABBQKxLI3FuTPmb//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ASf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAABBAMAAAAAAAAAAAAAAAAAAQIQESFBcf/aAAgBAQAGPwLRipdwU//EABoQAAMAAwEAAAAAAAAAAAAAAAABERBRkbH/2gAIAQEAAT8hYV9ElS9EJGPHeh//2gAMAwEAAgADAAAAEDAf/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERITH/2gAIAQMBAT8QeHQ9P//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxBDWL//xAAfEAEAAgEDBQAAAAAAAAAAAAABABEhMUFxYYGRsfD/2gAIAQEAAT8QwmUGA2HiEShKtdNHHWBVj0wp2raayfJxPdn/2Q==","aspectRatio":2.1739130434782608,"src":"/static/71f58cf3f523f11e385d1ad384146da5/14b42/ciqual.jpg","srcSet":"/static/71f58cf3f523f11e385d1ad384146da5/f836f/ciqual.jpg 200w,\n/static/71f58cf3f523f11e385d1ad384146da5/2244e/ciqual.jpg 400w,\n/static/71f58cf3f523f11e385d1ad384146da5/14b42/ciqual.jpg 800w,\n/static/71f58cf3f523f11e385d1ad384146da5/47498/ciqual.jpg 1200w,\n/static/71f58cf3f523f11e385d1ad384146da5/0e329/ciqual.jpg 1600w,\n/static/71f58cf3f523f11e385d1ad384146da5/71c6f/ciqual.jpg 1804w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"headings":[{"value":"Le jeu de données Ciqual","depth":2,"id":"le-jeu-de-données-ciqual"},{"value":"Format des données","depth":2,"id":"format-des-données"},{"value":"La base de données","depth":2,"id":"la-base-de-données"},{"value":"Création de la bdd","depth":3,"id":"création-de-la-bdd"},{"value":"Création des modèles","depth":3,"id":"création-des-modèles"},{"value":"Insérer des données dans la BDD","depth":3,"id":"insérer-des-données-dans-la-bdd"},{"value":"Récupérer les données","depth":3,"id":"récupérer-les-données"},{"value":"Conclusion","depth":2,"id":"conclusion"}]}},"pageContext":{"slug":"devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual","previous":{"fields":{"slug":"devlogs/2020-12-27-recette-ingredient-parser"},"frontmatter":{"tags":["python","web","scraper","parser","ingredient","recette"],"title":"Scraper de recettes et parser d'ingrédients","date":"2020-12-27T20:10:00.000Z","slug":null,"layout":"post","published":true}},"next":{"fields":{"slug":"python/2021-01-13-vm-in-python"},"frontmatter":{"tags":["python","assembleur","vm","compilation"],"title":"Machine virtuelle en Python","date":"2021-01-13T18:32:00.000Z","slug":null,"layout":"post","published":true}}}},"staticQueryHashes":["3433897746","712016698","781468736"]}
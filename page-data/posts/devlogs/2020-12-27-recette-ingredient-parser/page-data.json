{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/devlogs/2020-12-27-recette-ingredient-parser","result":{"data":{"site":{"siteMetadata":{"title":"Alexandre Froehlich"}},"markdownRemark":{"id":"fae6356b-0504-5a1a-bc15-81bea98290e9","excerpt":"Si le titre vous rend confus c’est peut être normal. Je vais essayer d’expliquer ce qu’est le scraping et le parsing que j’ai utilisé dans le cadre de mon projet: A Chef in the Fridge v2. Motivation Dans ma précédente itération, les recettes étaient entrées à la main à partir des ingrédients déjà présent dans la base de données. Non seulement cette solution n’était clairement pas intuitive et lente, mais elle est trop peu flexible 🤢. Pour cette itération je souhaite pouvoir importer automatiquement une recette depuis n’importe quel site le permettant (comme Marmiton ou 750g). Pour cela j’ai besoin de deux outils : Un scraper pour récupérer les données de la page web de la recette Un parser pour convertir les ingrédients en objets que le serveur pourra comprendre Le scraper de recettes On va commencer par les bases avant d’attaquer le sujet. Qu’est-ce qu’un scraper ? “Le web scraping (parfois appelé harvesting) est une technique d’extraction du contenu de sites Web, via un script ou un programme, dans le but de le transformer pour permettre son utilisation dans un autre contexte.”\n— Wikipedia Autrement dit, un scraper permet de récupérer les informations d’un site comme les objets présents sur la page ou les métadonnées. Cela se fait très simplement sur Python avec les bibliothèques  (intégrée) et . Prenons l’exemple de cette recette sur marmiton concernant un cake au poires et au chocolat: https://www.marmiton.org/recettes/recette_cake-aux-poires-et-chocolat-fondant_38922.aspx. On peut récupérer le contenu de la page à l’aide des lignes suivantes : Une histoire de méta(données) Une autre chose intéressante est que les sites de recettes, pour optimiser leur classement sur les moteurs de recherche (voir Search Engine Optimization), utilisent de nombreuses méta-données et il y en a une conçue spécialement pour les recettes. Le site schema.org décrit la structure des méta-données qui concernent les recettes ici. Pour commencer ces métadonnées sont présentes dans une balise  contenant un objet JSON décrivant la recette. Essayons pour voir sur notre lien précédent : Si on essaye d’afficher le contenu de la variable  on obtient ceci : On peut maintenant récupérer les ingrédients, le temps de préparation, le nombre de personnes, les notes et les étapes de préparation de la recette et tout cela en ne cherchant que dans l’en-tête de la page ! What a time to be alive Mais nouveau problème 😢 comment faire pour que le serveur comprenne “150 g de farine” ou “1…","tableOfContents":"<ul>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#motivation\">Motivation</a></li>\n<li>\n<p><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#le-scraper-de-recettes\">Le scraper de recettes</a></p>\n<ul>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#quest-ce-quun-scraper-\">Qu’est-ce qu’un scraper ?</a></li>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#une-histoire-de-m%C3%A9tadonn%C3%A9es\">Une histoire de méta(données)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#le-parser-dingr%C3%A9dients\">Le parser d’ingrédients</a></p>\n<ul>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#quest-ce-quun-parser-\">Qu’est-ce qu’un parser ?</a></li>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#a-quoi-sert-un-parser-dans-ce-projet\">A quoi sert un parser dans ce projet</a></li>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#impl%C3%A9mentation\">Implémentation</a></li>\n</ul>\n</li>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#conclusion\">Conclusion</a></li>\n</ul>","timeToRead":7,"html":"<p>Si le titre vous rend confus c’est peut être normal. Je vais essayer d’expliquer ce qu’est le scraping et le parsing que j’ai utilisé dans le cadre de mon projet: A Chef in the Fridge v2.</p>\n<h2 id=\"motivation\" style=\"position:relative;\"><a href=\"#motivation\" aria-label=\"motivation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Motivation</h2>\n<p>Dans ma précédente itération, les recettes étaient entrées à la main à partir des ingrédients déjà présent dans la base de données. Non seulement cette solution n’était clairement pas intuitive et lente, mais elle est trop peu flexible 🤢.</p>\n<p>Pour cette itération je souhaite pouvoir importer automatiquement une recette depuis n’importe quel site le permettant (comme <a href=\"https://www.marmiton.org/\">Marmiton</a> ou <a href=\"https://www.750g.com/\">750g</a>). Pour cela j’ai besoin de deux outils :</p>\n<ol>\n<li>Un scraper pour récupérer les données de la page web de la recette</li>\n<li>Un parser pour convertir les ingrédients en objets que le serveur pourra comprendre</li>\n</ol>\n<h2 id=\"le-scraper-de-recettes\" style=\"position:relative;\"><a href=\"#le-scraper-de-recettes\" aria-label=\"le scraper de recettes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le scraper de recettes</h2>\n<p>On va commencer par les bases avant d’attaquer le sujet.</p>\n<h3 id=\"quest-ce-quun-scraper-\" style=\"position:relative;\"><a href=\"#quest-ce-quun-scraper-\" aria-label=\"quest ce quun scraper  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Qu’est-ce qu’un scraper ?</h3>\n<blockquote>\n<p><em>“Le web scraping (parfois appelé harvesting) est une technique d’extraction du contenu de sites Web, via un script ou un programme, dans le but de le transformer pour permettre son utilisation dans un autre contexte.”</em>\n— <a href=\"https://fr.wikipedia.org/wiki/Web_scraping\">Wikipedia</a></p>\n</blockquote>\n<p>Autrement dit, un scraper permet de récupérer les informations d’un site comme les objets présents sur la page ou les métadonnées.</p>\n<p>Cela se fait très simplement sur Python avec les bibliothèques <code class=\"language-text\">requests</code> (intégrée) et <code class=\"language-text\">BeautifulSoup</code>.</p>\n<p>Prenons l’exemple de cette recette sur marmiton concernant un cake au poires et au chocolat: <a href=\"https://www.marmiton.org/recettes/recette_cake-aux-poires-et-chocolat-fondant_38922.aspx\">https://www.marmiton.org/recettes/recette_cake-aux-poires-et-chocolat-fondant_38922.aspx</a>. On peut récupérer le contenu de la page à l’aide des lignes suivantes :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">from</span> bs4 <span class=\"token keyword\">import</span> BeautifulSoup\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://www.marmiton.org/recettes/recette_cake-aux-poires-et-chocolat-fondant_38922.aspx\"</span>\n<span class=\"token comment\"># On récupère la page avec une requête GET</span>\npage <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># On traite son contenu pour l'utiliser</span>\nsoup <span class=\"token operator\">=</span> BeautifulSoup<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">,</span> <span class=\"token string\">\"html.parser\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># On récupère le titre de la page</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>soup<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># sortie : 'Cake aux poires et chocolat fondant : Recette de Cake aux poires et chocolat fondant - Marmiton'</span></code></pre></div>\n<h3 id=\"une-histoire-de-métadonnées\" style=\"position:relative;\"><a href=\"#une-histoire-de-m%C3%A9tadonn%C3%A9es\" aria-label=\"une histoire de métadonnées permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Une histoire de méta(données)</h3>\n<p>Une autre chose intéressante est que les sites de recettes, pour optimiser leur classement sur les moteurs de recherche (voir <a href=\"https://www.seo.fr/definition/seo-definition\">Search Engine Optimization</a>), utilisent de nombreuses méta-données et il y en a une conçue spécialement pour les recettes.</p>\n<p>Le site schema.org décrit la structure des méta-données qui concernent les recettes <a href=\"https://schema.org/Recipe\">ici</a>. Pour commencer ces métadonnées sont présentes dans une balise <code class=\"language-text\">&lt;script type=&quot;application/ld+json&quot;&gt;</code> contenant un objet JSON décrivant la recette.</p>\n<p>Essayons pour voir sur notre lien précédent :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># pour traiter le type de données</span>\n<span class=\"token keyword\">import</span> json\n\nrecette <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n<span class=\"token comment\"># on parcoure toutes les balises qui nous intéressent</span>\n<span class=\"token keyword\">for</span> balise <span class=\"token keyword\">in</span> soup<span class=\"token punctuation\">.</span>find_all<span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">type</span><span class=\"token operator\">=</span><span class=\"token string\">\"application/ld+json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>balise<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># on vérifie qu'il s'agisse bien d'une recette</span>\n    <span class=\"token keyword\">if</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">\"@type\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"Recipe\"</span><span class=\"token punctuation\">:</span>\n        recette <span class=\"token operator\">=</span> data\n        <span class=\"token keyword\">break</span>\n<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Aucune métadonnée de recette dans la page\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Si on essaye d’afficher le contenu de la variable <code class=\"language-text\">recette</code> on obtient ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"@context\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://schema.org\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Recipe\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Cake aux poires et chocolat fondant\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeCategory\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"autres cakes\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"image\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h1024c1cx2304cy1728.webp\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h768c1cx2304cy1728.webp\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h576c1cx2304cy1728.webp\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h1024c1cx2304cy1728.jpg\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h768c1cx2304cy1728.jpg\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h576c1cx2304cy1728.jpg\"</span>\n\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"datePublished\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2006-10-23T11:43:00+02:00\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"prepTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PT10M\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"cookTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PT40M\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"totalTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PT50M\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeYield\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"8 personnes\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeIngredient\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token string\">\"2 poires\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"150 g de farine\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"1 sachets de levure chimique\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"80 g de sucre\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"3 oeufs\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"90 g de beurre fondu\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"1 cuillères à soupe de cognac\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"50 g de chocolat (tablette)\"</span>\n\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeInstructions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Mélanger : farine, sucre, oeufs, beurre, levure, cognac jusqu'à obtenir une pâte homogène.\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Eplucher et couper les poires en dés. Réserver.\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Casser le chocolat en carrés.\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Dans un moule à cake beurré, verser la moitié de la pâte, au fond puis, disposer les dés de poire. Et placer, dessus, les dés de chocolat. Recouvrir, avec l'autre moitié de pâte.\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Enfourner dans un four chaud, à 180° (thermostat 6/7), pendant 40 à 45 min.\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"emma_14273358\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"poire, farine, levure chimique, sucre, oeuf, beurre, cognac, chocolat\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"keywords\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Cake aux poires et chocolat fondant, autres cakes, poire, farine, levure chimique, sucre, oeuf, beurre, cognac, chocolat,très facile,bon marché\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeCuisine\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"aggregateRating\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AggregateRating\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"reviewCount\"</span><span class=\"token operator\">:</span> <span class=\"token number\">53</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"ratingValue\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4.6</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"worstRating\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"bestRating\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>On peut maintenant récupérer les ingrédients, le temps de préparation, le nombre de personnes, les notes et les étapes de préparation de la recette et tout cela en ne cherchant que dans l’en-tête de la page !</p>\n<p><img src=\"https://media.giphy.com/media/u99fFT1YBzyco/giphy.gif\" alt=\"What a time to be alive\"></p>\n<p>Mais nouveau problème 😢 comment faire pour que le serveur comprenne “150 g de farine” ou “1 cuillères à soupe de cognac” ?</p>\n<p>Réponse : le parser à la rescousse !</p>\n<h2 id=\"le-parser-dingrédients\" style=\"position:relative;\"><a href=\"#le-parser-dingr%C3%A9dients\" aria-label=\"le parser dingrédients permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le parser d’ingrédients</h2>\n<p>Rebelote on commence par les bases pour ne pas se perdre.</p>\n<h3 id=\"quest-ce-quun-parser-\" style=\"position:relative;\"><a href=\"#quest-ce-quun-parser-\" aria-label=\"quest ce quun parser  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Qu’est-ce qu’un parser ?</h3>\n<p>Je vous épargne la définition wikipédia cette fois-ci. Pour essayer de faire simple, un parser est un programme qui va prendre un texte et le transformer d’abord en <code class=\"language-text\">TOKEN</code> (jetons en français) puis il peut passer ces jetons à un Lexer qui va ensuite chercher le lien entre ces jetons pour agir en conséquence.</p>\n<p>L’exemple le plus connu pour les parser est la programmation. En effet lorsqu’un code source est donné à un compilateur, il va d’abord le découper en jetons, puis à l’aide d’un arbre il va retracer le lien entre ces jetons en vérifiant que rien n’est manquant (coucou le ”;”) puis effectuer des optimisations avant de le traduire en code machine.</p>\n<h3 id=\"a-quoi-sert-un-parser-dans-ce-projet\" style=\"position:relative;\"><a href=\"#a-quoi-sert-un-parser-dans-ce-projet\" aria-label=\"a quoi sert un parser dans ce projet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A quoi sert un parser dans ce projet</h3>\n<p>Ici on va faire quelque chose de similaire mais sans passer par un lexer. On souhaite juste pouvoir récupérer les différents jetons qui nous intéressent. Prenons par exemple l’ingrédient “150g de farine”</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 375px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.81250000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdelAQcP/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAECAx/9oACAEBAAY/AhE//8QAGhABAAEFAAAAAAAAAAAAAAAAAQARIDFRgf/aAAgBAQABPyEBcSjqdWf/2gAMAwEAAgADAAAAEPPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQABBQAAAAAAAAAAAAAAAREAICExgfH/2gAIAQEAAT8QZJAcEswB3b1Mnto//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ingrédient : 150g de farine\"\n        title=\"Ingrédient : 150g de farine\"\n        src=\"/static/ff593a778587a6def1f765f98b9b393d/bf173/regex_ingredient.jpg\"\n        srcset=\"/static/ff593a778587a6def1f765f98b9b393d/cb69c/regex_ingredient.jpg 320w,\n/static/ff593a778587a6def1f765f98b9b393d/bf173/regex_ingredient.jpg 375w\"\n        sizes=\"(max-width: 375px) 100vw, 375px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Ce que je souhaite c’est que le programme puisse d’abord comprendre cet ingrédient sous la forme :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{quantité} {unité} {ingrédient}</code></pre></div>\n<p>Puis me sortir un objet, pourquoi pas du JSON, de la forme :</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"ingredient\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"farine\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"quantity\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"unit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gramme\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"amount\"</span><span class=\"token operator\">:</span> <span class=\"token number\">150</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ainsi je pourrais le réutiliser sans soucis dans le serveur et dans l’application.</p>\n<h3 id=\"implémentation\" style=\"position:relative;\"><a href=\"#impl%C3%A9mentation\" aria-label=\"implémentation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Implémentation</h3>\n<p>Pour cela je vais me baser sur le travail magnifique (mais en anglais) du groupe OpenCulinary et de leur <a href=\"https://github.com/openculinary/ingredient-parser\">parser d’ingrédient</a>.</p>\n<p>Pour cela je vais utiliser la bilbiothèque <code class=\"language-text\">parsimonious</code> qui permet de définir une grammaire et qui retourne non seulement un arbre des différents TOKEN trouvés mais permet de définir des fonctions de passage qui retourneront l’objet en question.</p>\n<p>Je passe sur la grammaire utilisée. Vous pouvez la retrouver dans un fichier texte disponible <a href=\"/7a15c27cf9abe00afeda1fed4c8d01ad/ing-parser-grammar.txt\">ici</a>.</p>\n<p>Cette grammaire supporte les unités métriques, anglaises (lbs, tbsp, …) et françaises (goutte, larme, sachet, branche, etc…).</p>\n<p>Il suffit de définir une classe qui hérite de <code class=\"language-text\">NodeVistor</code> avec les fonctions en fonction des différent matchs. En effet, la transformation en jetons se base sur des règles d’expressions régulières.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> parsimonious<span class=\"token punctuation\">.</span>grammar <span class=\"token keyword\">import</span> Grammar\n<span class=\"token keyword\">from</span> parsimonious<span class=\"token punctuation\">.</span>nodes <span class=\"token keyword\">import</span> NodeVisitor\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">IngredientParser</span><span class=\"token punctuation\">(</span>NodeVisitor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    grammar <span class=\"token operator\">=</span> Grammar<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># exemple de fonction de visite d'un noeud</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">visit_multipart_quantity</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> visited_children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">for</span> child <span class=\"token keyword\">in</span> visited_children<span class=\"token punctuation\">:</span>\n            unit<span class=\"token punctuation\">,</span> system<span class=\"token punctuation\">,</span> amount <span class=\"token operator\">=</span> child\n            <span class=\"token keyword\">if</span> results <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'unit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n                amount <span class=\"token operator\">*=</span> results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'amount'</span><span class=\"token punctuation\">]</span>\n                results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n            results<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'unit'</span><span class=\"token punctuation\">:</span> unit<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'unit_type'</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'amount'</span><span class=\"token punctuation\">:</span> amount\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> results</code></pre></div>\n<p>Avec ce code on arrive bien à transformer une ligne d’ingrédient en un objet réutilisable par le système. Victoire 🥳 !</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p><em>Je vais probablement mettre le code complet sur GitHub pour conserver une trace.</em></p>\n<p>C’est un premier pas vers la conception du backend de mon application. Je suis maintenant capable de scraper les sites de recettes pour récupérer leurs métadonnées et les transformer en recette.</p>\n<p>Je suis aussi capable de traiter les lignes d’ingrédients (ce qui me posait le plus de problèmes) cependant cette découpe n’est pas parfaite. En effet il ne fait pas (encore) la différence entre un ingrédient et la façon dont il est préparé (par exemple : ”<em>2 bottes de basilic frais</em>” donne pour ingrédient ”<em>basilic frais</em>” au lieu de ”<em>basilic</em>”).</p>\n<p>Les programmes ne sont jamais parfait il reste toujours quelque chose à améliorer. Pour moi cela me semble (enfin) satisfaisant pour cette itération.</p>","frontmatter":{"date":"December 27, 2020","title":"Scraper de recettes et parser d'ingrédients","slug":null,"tags":["python","web","scraper","parser","ingredient","recette"],"layout":"post","published":true,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdh42GAP/8QAGRAAAwADAAAAAAAAAAAAAAAAAQIQABEx/9oACAEBAAEFAlJzZidn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAECAx/9oACAEBAAY/AhU//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAEhMRARUaH/2gAIAQEAAT8haeoQunhIswqP/9oADAMBAAIAAwAAABAgD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAEUGRIVFhgf/aAAgBAQABPxB0WhcRSFILYPydvLArgXc9nc//2Q==","aspectRatio":1.8518518518518519,"src":"/static/a2efc87cb2279371153cac12d5e5b4fd/14b42/recipe_schema.jpg","srcSet":"/static/a2efc87cb2279371153cac12d5e5b4fd/f836f/recipe_schema.jpg 200w,\n/static/a2efc87cb2279371153cac12d5e5b4fd/2244e/recipe_schema.jpg 400w,\n/static/a2efc87cb2279371153cac12d5e5b4fd/14b42/recipe_schema.jpg 800w,\n/static/a2efc87cb2279371153cac12d5e5b4fd/6262e/recipe_schema.jpg 995w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"headings":[{"value":"Motivation","depth":2,"id":"motivation"},{"value":"Le scraper de recettes","depth":2,"id":"le-scraper-de-recettes"},{"value":"Qu’est-ce qu’un scraper ?","depth":3,"id":"quest-ce-quun-scraper-"},{"value":"Une histoire de méta(données)","depth":3,"id":"une-histoire-de-métadonnées"},{"value":"Le parser d’ingrédients","depth":2,"id":"le-parser-dingrédients"},{"value":"Qu’est-ce qu’un parser ?","depth":3,"id":"quest-ce-quun-parser-"},{"value":"A quoi sert un parser dans ce projet","depth":3,"id":"a-quoi-sert-un-parser-dans-ce-projet"},{"value":"Implémentation","depth":3,"id":"implémentation"},{"value":"Conclusion","depth":2,"id":"conclusion"}]}},"pageContext":{"slug":"devlogs/2020-12-27-recette-ingredient-parser","previous":{"fields":{"slug":"devlogs/2020-12-27-chef-in-fridge-v2-database"},"frontmatter":{"tags":["fullstack","bdd","sqlite","firebase","sql"],"title":"Base de données et objets : A Chef in the Fridge v2","date":"2020-12-27T09:28:00.000Z","slug":null,"layout":"post","published":true}},"next":{"fields":{"slug":"devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual"},"frontmatter":{"tags":["python","sql","xml","data"],"title":"Composition des ingrédients avec les données Ciqual","date":"2021-01-02T11:54:00.000Z","slug":null,"layout":"post","published":true}}}},"staticQueryHashes":["3433897746","712016698","781468736"]}
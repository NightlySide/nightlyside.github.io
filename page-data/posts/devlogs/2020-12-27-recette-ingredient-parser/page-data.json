{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/devlogs/2020-12-27-recette-ingredient-parser","result":{"data":{"site":{"siteMetadata":{"title":"Alexandre Froehlich"}},"markdownRemark":{"id":"fae6356b-0504-5a1a-bc15-81bea98290e9","excerpt":"Si le titre vous rend confus c‚Äôest peut √™tre normal. Je vais essayer d‚Äôexpliquer ce qu‚Äôest le scraping et le parsing que j‚Äôai utilis√© dans le cadre de mon projet: A Chef in the Fridge v2. Motivation Dans ma pr√©c√©dente it√©ration, les recettes √©taient entr√©es √† la main √† partir des ingr√©dients d√©j√† pr√©sent dans la base de donn√©es. Non seulement cette solution n‚Äô√©tait clairement pas intuitive et lente, mais elle est trop peu flexible ü§¢. Pour cette it√©ration je souhaite pouvoir importer automatiquement une recette depuis n‚Äôimporte quel site le permettant (comme Marmiton ou 750g). Pour cela j‚Äôai besoin de deux outils : Un scraper pour r√©cup√©rer les donn√©es de la page web de la recette Un parser pour convertir les ingr√©dients en objets que le serveur pourra comprendre Le scraper de recettes On va commencer par les bases avant d‚Äôattaquer le sujet. Qu‚Äôest-ce qu‚Äôun scraper ? ‚ÄúLe web scraping (parfois appel√© harvesting) est une technique d‚Äôextraction du contenu de sites Web, via un script ou un programme, dans le but de le transformer pour permettre son utilisation dans un autre contexte.‚Äù\n‚Äî Wikipedia Autrement dit, un scraper permet de r√©cup√©rer les informations d‚Äôun site comme les objets pr√©sents sur la page ou les m√©tadonn√©es. Cela se fait tr√®s simplement sur Python avec les biblioth√®ques  (int√©gr√©e) et . Prenons l‚Äôexemple de cette recette sur marmiton concernant un cake au poires et au chocolat: https://www.marmiton.org/recettes/recette_cake-aux-poires-et-chocolat-fondant_38922.aspx. On peut r√©cup√©rer le contenu de la page √† l‚Äôaide des lignes suivantes : Une histoire de m√©ta(donn√©es) Une autre chose int√©ressante est que les sites de recettes, pour optimiser leur classement sur les moteurs de recherche (voir Search Engine Optimization), utilisent de nombreuses m√©ta-donn√©es et il y en a une con√ßue sp√©cialement pour les recettes. Le site schema.org d√©crit la structure des m√©ta-donn√©es qui concernent les recettes ici. Pour commencer ces m√©tadonn√©es sont pr√©sentes dans une balise  contenant un objet JSON d√©crivant la recette. Essayons pour voir sur notre lien pr√©c√©dent : Si on essaye d‚Äôafficher le contenu de la variable  on obtient ceci : On peut maintenant r√©cup√©rer les ingr√©dients, le temps de pr√©paration, le nombre de personnes, les notes et les √©tapes de pr√©paration de la recette et tout cela en ne cherchant que dans l‚Äôen-t√™te de la page ! What a time to be alive Mais nouveau probl√®me üò¢ comment faire pour que le serveur comprenne ‚Äú150 g de farine‚Äù ou ‚Äú1‚Ä¶","tableOfContents":"<ul>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#motivation\">Motivation</a></li>\n<li>\n<p><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#le-scraper-de-recettes\">Le scraper de recettes</a></p>\n<ul>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#quest-ce-quun-scraper-\">Qu‚Äôest-ce qu‚Äôun scraper ?</a></li>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#une-histoire-de-m%C3%A9tadonn%C3%A9es\">Une histoire de m√©ta(donn√©es)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#le-parser-dingr%C3%A9dients\">Le parser d‚Äôingr√©dients</a></p>\n<ul>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#quest-ce-quun-parser-\">Qu‚Äôest-ce qu‚Äôun parser ?</a></li>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#a-quoi-sert-un-parser-dans-ce-projet\">A quoi sert un parser dans ce projet</a></li>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#impl%C3%A9mentation\">Impl√©mentation</a></li>\n</ul>\n</li>\n<li><a href=\"/devlogs/2020-12-27-recette-ingredient-parser/#conclusion\">Conclusion</a></li>\n</ul>","timeToRead":7,"html":"<p>Si le titre vous rend confus c‚Äôest peut √™tre normal. Je vais essayer d‚Äôexpliquer ce qu‚Äôest le scraping et le parsing que j‚Äôai utilis√© dans le cadre de mon projet: A Chef in the Fridge v2.</p>\n<h2 id=\"motivation\" style=\"position:relative;\"><a href=\"#motivation\" aria-label=\"motivation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Motivation</h2>\n<p>Dans ma pr√©c√©dente it√©ration, les recettes √©taient entr√©es √† la main √† partir des ingr√©dients d√©j√† pr√©sent dans la base de donn√©es. Non seulement cette solution n‚Äô√©tait clairement pas intuitive et lente, mais elle est trop peu flexible ü§¢.</p>\n<p>Pour cette it√©ration je souhaite pouvoir importer automatiquement une recette depuis n‚Äôimporte quel site le permettant (comme <a href=\"https://www.marmiton.org/\">Marmiton</a> ou <a href=\"https://www.750g.com/\">750g</a>). Pour cela j‚Äôai besoin de deux outils :</p>\n<ol>\n<li>Un scraper pour r√©cup√©rer les donn√©es de la page web de la recette</li>\n<li>Un parser pour convertir les ingr√©dients en objets que le serveur pourra comprendre</li>\n</ol>\n<h2 id=\"le-scraper-de-recettes\" style=\"position:relative;\"><a href=\"#le-scraper-de-recettes\" aria-label=\"le scraper de recettes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le scraper de recettes</h2>\n<p>On va commencer par les bases avant d‚Äôattaquer le sujet.</p>\n<h3 id=\"quest-ce-quun-scraper-\" style=\"position:relative;\"><a href=\"#quest-ce-quun-scraper-\" aria-label=\"quest ce quun scraper  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Qu‚Äôest-ce qu‚Äôun scraper ?</h3>\n<blockquote>\n<p><em>‚ÄúLe web scraping (parfois appel√© harvesting) est une technique d‚Äôextraction du contenu de sites Web, via un script ou un programme, dans le but de le transformer pour permettre son utilisation dans un autre contexte.‚Äù</em>\n‚Äî <a href=\"https://fr.wikipedia.org/wiki/Web_scraping\">Wikipedia</a></p>\n</blockquote>\n<p>Autrement dit, un scraper permet de r√©cup√©rer les informations d‚Äôun site comme les objets pr√©sents sur la page ou les m√©tadonn√©es.</p>\n<p>Cela se fait tr√®s simplement sur Python avec les biblioth√®ques <code class=\"language-text\">requests</code> (int√©gr√©e) et <code class=\"language-text\">BeautifulSoup</code>.</p>\n<p>Prenons l‚Äôexemple de cette recette sur marmiton concernant un cake au poires et au chocolat: <a href=\"https://www.marmiton.org/recettes/recette_cake-aux-poires-et-chocolat-fondant_38922.aspx\">https://www.marmiton.org/recettes/recette_cake-aux-poires-et-chocolat-fondant_38922.aspx</a>. On peut r√©cup√©rer le contenu de la page √† l‚Äôaide des lignes suivantes :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">from</span> bs4 <span class=\"token keyword\">import</span> BeautifulSoup\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://www.marmiton.org/recettes/recette_cake-aux-poires-et-chocolat-fondant_38922.aspx\"</span>\n<span class=\"token comment\"># On r√©cup√®re la page avec une requ√™te GET</span>\npage <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># On traite son contenu pour l'utiliser</span>\nsoup <span class=\"token operator\">=</span> BeautifulSoup<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">,</span> <span class=\"token string\">\"html.parser\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># On r√©cup√®re le titre de la page</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>soup<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># sortie : 'Cake aux poires et chocolat fondant : Recette de Cake aux poires et chocolat fondant - Marmiton'</span></code></pre></div>\n<h3 id=\"une-histoire-de-m√©tadonn√©es\" style=\"position:relative;\"><a href=\"#une-histoire-de-m%C3%A9tadonn%C3%A9es\" aria-label=\"une histoire de m√©tadonn√©es permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Une histoire de m√©ta(donn√©es)</h3>\n<p>Une autre chose int√©ressante est que les sites de recettes, pour optimiser leur classement sur les moteurs de recherche (voir <a href=\"https://www.seo.fr/definition/seo-definition\">Search Engine Optimization</a>), utilisent de nombreuses m√©ta-donn√©es et il y en a une con√ßue sp√©cialement pour les recettes.</p>\n<p>Le site schema.org d√©crit la structure des m√©ta-donn√©es qui concernent les recettes <a href=\"https://schema.org/Recipe\">ici</a>. Pour commencer ces m√©tadonn√©es sont pr√©sentes dans une balise <code class=\"language-text\">&lt;script type=&quot;application/ld+json&quot;&gt;</code> contenant un objet JSON d√©crivant la recette.</p>\n<p>Essayons pour voir sur notre lien pr√©c√©dent :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># pour traiter le type de donn√©es</span>\n<span class=\"token keyword\">import</span> json\n\nrecette <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n<span class=\"token comment\"># on parcoure toutes les balises qui nous int√©ressent</span>\n<span class=\"token keyword\">for</span> balise <span class=\"token keyword\">in</span> soup<span class=\"token punctuation\">.</span>find_all<span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">type</span><span class=\"token operator\">=</span><span class=\"token string\">\"application/ld+json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>balise<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># on v√©rifie qu'il s'agisse bien d'une recette</span>\n    <span class=\"token keyword\">if</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">\"@type\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"Recipe\"</span><span class=\"token punctuation\">:</span>\n        recette <span class=\"token operator\">=</span> data\n        <span class=\"token keyword\">break</span>\n<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Aucune m√©tadonn√©e de recette dans la page\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Si on essaye d‚Äôafficher le contenu de la variable <code class=\"language-text\">recette</code> on obtient ceci :</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"@context\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://schema.org\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Recipe\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Cake aux poires et chocolat fondant\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeCategory\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"autres cakes\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"image\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h1024c1cx2304cy1728.webp\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h768c1cx2304cy1728.webp\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h576c1cx2304cy1728.webp\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h1024c1cx2304cy1728.jpg\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h768c1cx2304cy1728.jpg\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"https://assets.afcdn.com/recipe/20131123/8075_w1024h576c1cx2304cy1728.jpg\"</span>\n\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"datePublished\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2006-10-23T11:43:00+02:00\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"prepTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PT10M\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"cookTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PT40M\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"totalTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PT50M\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeYield\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"8 personnes\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeIngredient\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token string\">\"2 poires\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"150 g de farine\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"1 sachets de levure chimique\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"80 g de sucre\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"3 oeufs\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"90 g de beurre fondu\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"1 cuill√®res √† soupe de cognac\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"50 g de chocolat (tablette)\"</span>\n\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeInstructions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"M√©langer : farine, sucre, oeufs, beurre, levure, cognac jusqu'√† obtenir une p√¢te homog√®ne.\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Eplucher et couper les poires en d√©s. R√©server.\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Casser le chocolat en carr√©s.\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Dans un moule √† cake beurr√©, verser la moiti√© de la p√¢te, au fond puis, disposer les d√©s de poire. Et placer, dessus, les d√©s de chocolat. Recouvrir, avec l'autre moiti√© de p√¢te.\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HowToStep\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Enfourner dans un four chaud, √† 180¬∞ (thermostat 6/7), pendant 40 √† 45 min.\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"emma_14273358\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"poire, farine, levure chimique, sucre, oeuf, beurre, cognac, chocolat\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"keywords\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Cake aux poires et chocolat fondant, autres cakes, poire, farine, levure chimique, sucre, oeuf, beurre, cognac, chocolat,tr√®s facile,bon march√©\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"recipeCuisine\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"aggregateRating\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AggregateRating\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"reviewCount\"</span><span class=\"token operator\">:</span> <span class=\"token number\">53</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"ratingValue\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4.6</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"worstRating\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"bestRating\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>On peut maintenant r√©cup√©rer les ingr√©dients, le temps de pr√©paration, le nombre de personnes, les notes et les √©tapes de pr√©paration de la recette et tout cela en ne cherchant que dans l‚Äôen-t√™te de la page !</p>\n<p><img src=\"https://media.giphy.com/media/u99fFT1YBzyco/giphy.gif\" alt=\"What a time to be alive\"></p>\n<p>Mais nouveau probl√®me üò¢ comment faire pour que le serveur comprenne ‚Äú150 g de farine‚Äù ou ‚Äú1 cuill√®res √† soupe de cognac‚Äù ?</p>\n<p>R√©ponse : le parser √† la rescousse !</p>\n<h2 id=\"le-parser-dingr√©dients\" style=\"position:relative;\"><a href=\"#le-parser-dingr%C3%A9dients\" aria-label=\"le parser dingr√©dients permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le parser d‚Äôingr√©dients</h2>\n<p>Rebelote on commence par les bases pour ne pas se perdre.</p>\n<h3 id=\"quest-ce-quun-parser-\" style=\"position:relative;\"><a href=\"#quest-ce-quun-parser-\" aria-label=\"quest ce quun parser  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Qu‚Äôest-ce qu‚Äôun parser ?</h3>\n<p>Je vous √©pargne la d√©finition wikip√©dia cette fois-ci. Pour essayer de faire simple, un parser est un programme qui va prendre un texte et le transformer d‚Äôabord en <code class=\"language-text\">TOKEN</code> (jetons en fran√ßais) puis il peut passer ces jetons √† un Lexer qui va ensuite chercher le lien entre ces jetons pour agir en cons√©quence.</p>\n<p>L‚Äôexemple le plus connu pour les parser est la programmation. En effet lorsqu‚Äôun code source est donn√© √† un compilateur, il va d‚Äôabord le d√©couper en jetons, puis √† l‚Äôaide d‚Äôun arbre il va retracer le lien entre ces jetons en v√©rifiant que rien n‚Äôest manquant (coucou le ‚Äù;‚Äù) puis effectuer des optimisations avant de le traduire en code machine.</p>\n<h3 id=\"a-quoi-sert-un-parser-dans-ce-projet\" style=\"position:relative;\"><a href=\"#a-quoi-sert-un-parser-dans-ce-projet\" aria-label=\"a quoi sert un parser dans ce projet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A quoi sert un parser dans ce projet</h3>\n<p>Ici on va faire quelque chose de similaire mais sans passer par un lexer. On souhaite juste pouvoir r√©cup√©rer les diff√©rents jetons qui nous int√©ressent. Prenons par exemple l‚Äôingr√©dient ‚Äú150g de farine‚Äù</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 375px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.81250000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdelAQcP/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAECAx/9oACAEBAAY/AhE//8QAGhABAAEFAAAAAAAAAAAAAAAAAQARIDFRgf/aAAgBAQABPyEBcSjqdWf/2gAMAwEAAgADAAAAEPPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQABBQAAAAAAAAAAAAAAAREAICExgfH/2gAIAQEAAT8QZJAcEswB3b1Mnto//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ingr√©dient : 150g de farine\"\n        title=\"Ingr√©dient : 150g de farine\"\n        src=\"/static/ff593a778587a6def1f765f98b9b393d/bf173/regex_ingredient.jpg\"\n        srcset=\"/static/ff593a778587a6def1f765f98b9b393d/cb69c/regex_ingredient.jpg 320w,\n/static/ff593a778587a6def1f765f98b9b393d/bf173/regex_ingredient.jpg 375w\"\n        sizes=\"(max-width: 375px) 100vw, 375px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Ce que je souhaite c‚Äôest que le programme puisse d‚Äôabord comprendre cet ingr√©dient sous la forme :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{quantit√©} {unit√©} {ingr√©dient}</code></pre></div>\n<p>Puis me sortir un objet, pourquoi pas du JSON, de la forme :</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"ingredient\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"farine\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"quantity\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"unit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gramme\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token property\">\"amount\"</span><span class=\"token operator\">:</span> <span class=\"token number\">150</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ainsi je pourrais le r√©utiliser sans soucis dans le serveur et dans l‚Äôapplication.</p>\n<h3 id=\"impl√©mentation\" style=\"position:relative;\"><a href=\"#impl%C3%A9mentation\" aria-label=\"impl√©mentation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impl√©mentation</h3>\n<p>Pour cela je vais me baser sur le travail magnifique (mais en anglais) du groupe OpenCulinary et de leur <a href=\"https://github.com/openculinary/ingredient-parser\">parser d‚Äôingr√©dient</a>.</p>\n<p>Pour cela je vais utiliser la bilbioth√®que <code class=\"language-text\">parsimonious</code> qui permet de d√©finir une grammaire et qui retourne non seulement un arbre des diff√©rents TOKEN trouv√©s mais permet de d√©finir des fonctions de passage qui retourneront l‚Äôobjet en question.</p>\n<p>Je passe sur la grammaire utilis√©e. Vous pouvez la retrouver dans un fichier texte disponible <a href=\"/7a15c27cf9abe00afeda1fed4c8d01ad/ing-parser-grammar.txt\">ici</a>.</p>\n<p>Cette grammaire supporte les unit√©s m√©triques, anglaises (lbs, tbsp, ‚Ä¶) et fran√ßaises (goutte, larme, sachet, branche, etc‚Ä¶).</p>\n<p>Il suffit de d√©finir une classe qui h√©rite de <code class=\"language-text\">NodeVistor</code> avec les fonctions en fonction des diff√©rent matchs. En effet, la transformation en jetons se base sur des r√®gles d‚Äôexpressions r√©guli√®res.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> parsimonious<span class=\"token punctuation\">.</span>grammar <span class=\"token keyword\">import</span> Grammar\n<span class=\"token keyword\">from</span> parsimonious<span class=\"token punctuation\">.</span>nodes <span class=\"token keyword\">import</span> NodeVisitor\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">IngredientParser</span><span class=\"token punctuation\">(</span>NodeVisitor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    grammar <span class=\"token operator\">=</span> Grammar<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># exemple de fonction de visite d'un noeud</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">visit_multipart_quantity</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> visited_children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">for</span> child <span class=\"token keyword\">in</span> visited_children<span class=\"token punctuation\">:</span>\n            unit<span class=\"token punctuation\">,</span> system<span class=\"token punctuation\">,</span> amount <span class=\"token operator\">=</span> child\n            <span class=\"token keyword\">if</span> results <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'unit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n                amount <span class=\"token operator\">*=</span> results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'amount'</span><span class=\"token punctuation\">]</span>\n                results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n            results<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'unit'</span><span class=\"token punctuation\">:</span> unit<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'unit_type'</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'amount'</span><span class=\"token punctuation\">:</span> amount\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> results</code></pre></div>\n<p>Avec ce code on arrive bien √† transformer une ligne d‚Äôingr√©dient en un objet r√©utilisable par le syst√®me. Victoire ü•≥ !</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p><em>Je vais probablement mettre le code complet sur GitHub pour conserver une trace.</em></p>\n<p>C‚Äôest un premier pas vers la conception du backend de mon application. Je suis maintenant capable de scraper les sites de recettes pour r√©cup√©rer leurs m√©tadonn√©es et les transformer en recette.</p>\n<p>Je suis aussi capable de traiter les lignes d‚Äôingr√©dients (ce qui me posait le plus de probl√®mes) cependant cette d√©coupe n‚Äôest pas parfaite. En effet il ne fait pas (encore) la diff√©rence entre un ingr√©dient et la fa√ßon dont il est pr√©par√© (par exemple : ‚Äù<em>2 bottes de basilic frais</em>‚Äù donne pour ingr√©dient ‚Äù<em>basilic frais</em>‚Äù au lieu de ‚Äù<em>basilic</em>‚Äù).</p>\n<p>Les programmes ne sont jamais parfait il reste toujours quelque chose √† am√©liorer. Pour moi cela me semble (enfin) satisfaisant pour cette it√©ration.</p>","frontmatter":{"date":"December 27, 2020","title":"Scraper de recettes et parser d'ingr√©dients","slug":null,"tags":["python","web","scraper","parser","ingredient","recette"],"layout":"post","published":true,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdh42GAP/8QAGRAAAwADAAAAAAAAAAAAAAAAAQIQABEx/9oACAEBAAEFAlJzZidn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAECAx/9oACAEBAAY/AhU//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAEhMRARUaH/2gAIAQEAAT8haeoQunhIswqP/9oADAMBAAIAAwAAABAgD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAEUGRIVFhgf/aAAgBAQABPxB0WhcRSFILYPydvLArgXc9nc//2Q==","aspectRatio":1.8518518518518519,"src":"/static/a2efc87cb2279371153cac12d5e5b4fd/14b42/recipe_schema.jpg","srcSet":"/static/a2efc87cb2279371153cac12d5e5b4fd/f836f/recipe_schema.jpg 200w,\n/static/a2efc87cb2279371153cac12d5e5b4fd/2244e/recipe_schema.jpg 400w,\n/static/a2efc87cb2279371153cac12d5e5b4fd/14b42/recipe_schema.jpg 800w,\n/static/a2efc87cb2279371153cac12d5e5b4fd/6262e/recipe_schema.jpg 995w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"headings":[{"value":"Motivation","depth":2,"id":"motivation"},{"value":"Le scraper de recettes","depth":2,"id":"le-scraper-de-recettes"},{"value":"Qu‚Äôest-ce qu‚Äôun scraper ?","depth":3,"id":"quest-ce-quun-scraper-"},{"value":"Une histoire de m√©ta(donn√©es)","depth":3,"id":"une-histoire-de-m√©tadonn√©es"},{"value":"Le parser d‚Äôingr√©dients","depth":2,"id":"le-parser-dingr√©dients"},{"value":"Qu‚Äôest-ce qu‚Äôun parser ?","depth":3,"id":"quest-ce-quun-parser-"},{"value":"A quoi sert un parser dans ce projet","depth":3,"id":"a-quoi-sert-un-parser-dans-ce-projet"},{"value":"Impl√©mentation","depth":3,"id":"impl√©mentation"},{"value":"Conclusion","depth":2,"id":"conclusion"}]}},"pageContext":{"slug":"devlogs/2020-12-27-recette-ingredient-parser","previous":{"fields":{"slug":"devlogs/2020-12-27-chef-in-fridge-v2-database"},"frontmatter":{"tags":["fullstack","bdd","sqlite","firebase","sql"],"title":"Base de donn√©es et objets : A Chef in the Fridge v2","date":"2020-12-27T09:28:00.000Z","slug":null,"layout":"post","published":true}},"next":{"fields":{"slug":"devlogs/2021-01-02-a-chef-in-fridge-v2-ciqual"},"frontmatter":{"tags":["python","sql","xml","data"],"title":"Composition des ingr√©dients avec les donn√©es Ciqual","date":"2021-01-02T11:54:00.000Z","slug":null,"layout":"post","published":true}}}},"staticQueryHashes":["3433897746","712016698","781468736"]}
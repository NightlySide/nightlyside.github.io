{"componentChunkName":"component---src-templates-post-tsx","path":"/posts/2020-06-26-chatbot-vocal","result":{"data":{"site":{"siteMetadata":{"title":"Alexandre Froehlich"}},"markdownRemark":{"id":"e3c05907-2468-5c43-be16-97e10f33d976","excerpt":"Les chatbots commerciaux sont de plus en plus présents sur les sites de grande distribution ou de services à grande échelle. Je me suis demandé à quel point il était facile de concevoir un chatbox vocal en utilisant python et Dialogflow. Le code du projet est disponible sur github : https://github.com/NightlySide/ChatBox-Vocal Comme tout projet, il faut pouvoir trouver un point d’entrée afin de ne pas se perdre. Je décide donc de commencer par traduire du français oral en texte. Le speech to text Python étant très versatile et surtout très populaire, il existe une multitude de bibliothèques pour faire de la traduction de vocal vers texte. N’en connaissant aucun, j’ai cherché à savoir parmi toutes ces bibliothèques, lesquelles fonctionnaient pour une traduction en français. Je me suis arrêté sur Speech-Recognition qui me semble bien fourni en documentation, qui fonctionne avec diverses API de reconnaissance de texte, mais surtout qui comprend bien le français ! Un premier script permet d’essayer cette fonctionnalité en écoutant puis en traduisant ce qui a été dit : Il ne reste plus qu’à tout mettre dans une fonction, ou plutôt dans une classe en ajoutant les fonctions d’écoute en arrière plan avec une fonction “callback”. Le code final pour cette classe est le suivant : Maintenant le programme est capable d’écouter en arrière plan, de détecter une phrase et de la convertir en texte, ici grâce à l’API de google. Le text to speech Afin de pouvoir parler de chatbot vocal, il est intéressant de faire “parler” la machine. De même je vais chercher une bibliothèque capable de parler en français pour des raisons évidentes.\nPour commencer j’ai décidé d’utiliser Google Text-to-speech par sa simplicité et sa popularité. Plus tard il serait intéressant d’enregistrer moi même les phrases surtout si le chatbot vocal possède une quantité réduite de mots.\nPour jouer le son je voulais au départ utiliser PyAudio, j’ai choisi sur une bibliothèque bien plus simple à utiliser : playsound qui est en plus cross platform ! Le code simple pour faire une phrase est le suivant : Il est bien mieux d’utiliser  pour supprimer un fichier que  Il ne reste plus qu’à créer la fonction correspondante, pas besoin de créer une classe ici. Finalement la fonction devient la suivante : J’en ai profité pour ajouter un nom de fichier aléatoire pour éviter le cas ou la fonction est appelée plusieurs fois en même temps, à l’aide d’un UUID. La conversation Pour créer un chatbot un minimum intelligent…","tableOfContents":"<ul>\n<li><a href=\"/2020-06-26-chatbot-vocal/#le-speech-to-text\">Le speech to text</a></li>\n<li><a href=\"/2020-06-26-chatbot-vocal/#le-text-to-speech\">Le text to speech</a></li>\n<li><a href=\"/2020-06-26-chatbot-vocal/#la-conversation\">La conversation</a></li>\n<li><a href=\"/2020-06-26-chatbot-vocal/#conclusion\">Conclusion</a></li>\n</ul>","timeToRead":5,"html":"<p>Les chatbots commerciaux sont de plus en plus présents sur les sites de grande distribution ou de services à grande échelle. Je me suis demandé à quel point il était facile de concevoir un chatbox vocal en utilisant python et <a href=\"https://dialogflow.cloud.google.com\">Dialogflow</a>.</p>\n<blockquote>\n<p>Le code du projet est disponible sur github : <a href=\"https://github.com/NightlySide/ChatBox-Vocal\">https://github.com/NightlySide/ChatBox-Vocal</a></p>\n</blockquote>\n<p>Comme tout projet, il faut pouvoir trouver un point d’entrée afin de ne pas se perdre. Je décide donc de commencer par traduire du français oral en texte.</p>\n<h2 id=\"le-speech-to-text\" style=\"position:relative;\"><a href=\"#le-speech-to-text\" aria-label=\"le speech to text permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le speech to text</h2>\n<p>Python étant très versatile et surtout très populaire, il existe une multitude de bibliothèques pour faire de la traduction de vocal vers texte. N’en connaissant aucun, j’ai cherché à savoir parmi toutes ces bibliothèques, lesquelles fonctionnaient pour une traduction en français. Je me suis arrêté sur <a href=\"https://pypi.org/project/SpeechRecognition/\">Speech-Recognition</a> qui me semble bien fourni en documentation, qui fonctionne avec diverses API de reconnaissance de texte, mais surtout qui comprend bien le français !</p>\n<p>Un premier script permet d’essayer cette fonctionnalité en écoutant puis en traduisant ce qui a été dit :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> speech_recognition <span class=\"token keyword\">as</span> sr\n\n<span class=\"token comment\"># On enregistre l'audio</span>\nr <span class=\"token operator\">=</span> sr<span class=\"token punctuation\">.</span>Recognizer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">with</span> sr<span class=\"token punctuation\">.</span>Microphone<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> source<span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># On ecoute une seconde pour calibrer le bruit ambiant du micro</span>\n    r<span class=\"token punctuation\">.</span>adjust_for_ambient_noise<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Je vous écoute\"</span><span class=\"token punctuation\">)</span>\n    audio <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span>listen<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># On essaie de comprendre ce qui a été dit</span>\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Tu as dit : \"</span> <span class=\"token operator\">+</span> r<span class=\"token punctuation\">.</span>recognize_google<span class=\"token punctuation\">(</span>audio<span class=\"token punctuation\">,</span> language<span class=\"token operator\">=</span><span class=\"token string\">\"fr-FR\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">except</span> sr<span class=\"token punctuation\">.</span>UnknownValueError<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"L'audio n'a pas pu être compris\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">except</span> sr<span class=\"token punctuation\">.</span>RequestError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"Impossible d'envoyer la requête. Erreur : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>e<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Il ne reste plus qu’à tout mettre dans une fonction, ou plutôt dans une classe en ajoutant les fonctions d’écoute en arrière plan avec une fonction “callback”. Le code final pour cette classe est le suivant :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">SpeechRecognition</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>r <span class=\"token operator\">=</span> sr<span class=\"token punctuation\">.</span>Recognizer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>m <span class=\"token operator\">=</span> sr<span class=\"token punctuation\">.</span>Microphone<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># On crée la fonction d'arrêt</span>\n        self<span class=\"token punctuation\">.</span>_stop_listening <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">start_listening</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> callback<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\" Permet de lancer l'écoute du micro en arrière-plan\n        \"\"\"</span>\n        <span class=\"token comment\"># On ajuste au bruit ambiant</span>\n        <span class=\"token keyword\">with</span> self<span class=\"token punctuation\">.</span>m <span class=\"token keyword\">as</span> source<span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">.</span>adjust_for_ambient_noise<span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> callback <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            callback <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>_listening_callback\n        self<span class=\"token punctuation\">.</span>_stop_listening <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">.</span>listen_in_background<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Je vous écoute\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">stop_listening</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\" Permet d'arrêter l'écoute du micro en arrière-plan\n        \"\"\"</span>\n        self<span class=\"token punctuation\">.</span>_stop_listening<span class=\"token punctuation\">(</span>wait_for_stop<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Arrêt de l'écoute en arrière plan\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token decorator annotation punctuation\">@staticmethod</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">_listening_callback</span><span class=\"token punctuation\">(</span>recognizer<span class=\"token punctuation\">,</span> audio<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\" Fonction appellée en arrière plan dans un thread à part\n        \"\"\"</span>\n        <span class=\"token comment\"># On a récupéré des données on va essayer de le traduire</span>\n        <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Vous avez dit : \"</span> <span class=\"token operator\">+</span> recognizer<span class=\"token punctuation\">.</span>recognize_google<span class=\"token punctuation\">(</span>audio <span class=\"token punctuation\">,</span> language<span class=\"token operator\">=</span><span class=\"token string\">\"fr-FR\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">except</span> sr<span class=\"token punctuation\">.</span>UnknownValueError<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"L'audio n'a pas pu être compris\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">except</span> sr<span class=\"token punctuation\">.</span>RequestError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"Impossible d'envoyer la requête. Erreur : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>e<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Maintenant le programme est capable d’écouter en arrière plan, de détecter une phrase et de la convertir en texte, ici grâce à l’API de google.</p>\n<h2 id=\"le-text-to-speech\" style=\"position:relative;\"><a href=\"#le-text-to-speech\" aria-label=\"le text to speech permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le text to speech</h2>\n<p>Afin de pouvoir parler de chatbot vocal, il est intéressant de faire “parler” la machine. De même je vais chercher une bibliothèque capable de parler en français pour des raisons évidentes.\nPour commencer j’ai décidé d’utiliser <a href=\"https://pypi.org/project/gTTS/\">Google Text-to-speech</a> par sa simplicité et sa popularité. Plus tard il serait intéressant d’enregistrer moi même les phrases surtout si le chatbot vocal possède une quantité réduite de mots.\nPour jouer le son je voulais au départ utiliser PyAudio, j’ai choisi sur une bibliothèque bien plus simple à utiliser : <a href=\"https://pypi.org/project/playsound/\">playsound</a> qui est en plus cross platform !</p>\n<p>Le code simple pour faire une phrase est le suivant :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">from</span> gtts <span class=\"token keyword\">import</span> gTTS\n<span class=\"token keyword\">from</span> playsound <span class=\"token keyword\">import</span> playsound\n\ntexte <span class=\"token operator\">=</span> <span class=\"token string\">\"Bonjour à tous! Aujourd'hui les amis on va parler ensemble ...\"</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Getting voice output\"</span><span class=\"token punctuation\">)</span>\nmyobj <span class=\"token operator\">=</span> gTTS<span class=\"token punctuation\">(</span>text<span class=\"token operator\">=</span>texte<span class=\"token punctuation\">,</span> lang<span class=\"token operator\">=</span><span class=\"token string\">\"fr\"</span><span class=\"token punctuation\">,</span> slow<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\nmyobj<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token string\">\"temp.mp3\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Playing sound\"</span><span class=\"token punctuation\">)</span>\nplaysound<span class=\"token punctuation\">(</span><span class=\"token string\">\"temp.mp3\"</span><span class=\"token punctuation\">)</span>\nos<span class=\"token punctuation\">.</span>unlink<span class=\"token punctuation\">(</span><span class=\"token string\">\"temp.mp3\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>Il est bien mieux d’utiliser <code class=\"language-text\">os.unlink(&quot;file.mp3&quot;)</code> pour supprimer un fichier que <code class=\"language-text\">os.system(&quot;rm file.mp3&quot;)</code></p>\n</blockquote>\n<p>Il ne reste plus qu’à créer la fonction correspondante, pas besoin de créer une classe ici. Finalement la fonction devient la suivante :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">speak</span><span class=\"token punctuation\">(</span>texte<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    filename <span class=\"token operator\">=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>uuid4<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".mp3\"</span>\n    myobj <span class=\"token operator\">=</span> gTTS<span class=\"token punctuation\">(</span>text<span class=\"token operator\">=</span>texte<span class=\"token punctuation\">,</span> lang<span class=\"token operator\">=</span><span class=\"token string\">\"fr\"</span><span class=\"token punctuation\">,</span> slow<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    myobj<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span>\n    playsound<span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span>\n    os<span class=\"token punctuation\">.</span>unlink<span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span></code></pre></div>\n<p>J’en ai profité pour ajouter un nom de fichier aléatoire pour éviter le cas ou la fonction est appelée plusieurs fois en même temps, à l’aide d’un <a href=\"https://fr.wikipedia.org/wiki/Universal_Unique_Identifier\">UUID</a>.</p>\n<h2 id=\"la-conversation\" style=\"position:relative;\"><a href=\"#la-conversation\" aria-label=\"la conversation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>La conversation</h2>\n<p>Pour créer un chatbot un minimum intelligent, on peut s’amuser à coder une sorte d’intelligence artificielle qui comprends le fond de la phrase puis est capable de répondre en conséquences. Cependant le travail nécessaire pour mettre en place ce concept mérite son sujet et son projet séparé. Afin de pouvoir continuer ce projet, de nombreuses entreprises ont déjà une telle interface accessible depuis une API.</p>\n<p>J’ai décidé de partir sur <a href=\"https://dialogflow.cloud.google.com/\">Dialogflow</a> et je vais essayer d’expliquer simplement son fonctionnement.</p>\n<p>Après s’être connecté et crée un projet, Google nous présente deux exemples pour comprendre comment le système fonctionne.\nDu côté du code, j’ai repris l’exemple donné sur un <a href=\"https://medium.com/swlh/working-with-dialogflow-using-python-client-cb2196d579a4\">article de Medium</a> qui permet d’accéder aux requêtes avec une clé privée.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> dialogflow\n<span class=\"token keyword\">from</span> google<span class=\"token punctuation\">.</span>api_core<span class=\"token punctuation\">.</span>exceptions <span class=\"token keyword\">import</span> InvalidArgument\n\nos<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">\"GOOGLE_APPLICATION_CREDENTIALS\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'private_key.json'</span>\n\nDIALOGFLOW_PROJECT_ID <span class=\"token operator\">=</span> <span class=\"token string\">'[PROJECT_ID]'</span>\nDIALOGFLOW_LANGUAGE_CODE <span class=\"token operator\">=</span> <span class=\"token string\">'fr'</span>\nSESSION_ID <span class=\"token operator\">=</span> <span class=\"token string\">'me'</span>\n\ntext_to_be_analyzed <span class=\"token operator\">=</span> <span class=\"token string\">\"Bonjour\"</span>\n\nsession_client <span class=\"token operator\">=</span> dialogflow<span class=\"token punctuation\">.</span>SessionsClient<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> session_client<span class=\"token punctuation\">.</span>session_path<span class=\"token punctuation\">(</span>DIALOGFLOW_PROJECT_ID<span class=\"token punctuation\">,</span> SESSION_ID<span class=\"token punctuation\">)</span>\ntext_input <span class=\"token operator\">=</span> dialogflow<span class=\"token punctuation\">.</span>types<span class=\"token punctuation\">.</span>TextInput<span class=\"token punctuation\">(</span>text<span class=\"token operator\">=</span>text_to_be_analyzed<span class=\"token punctuation\">,</span> language_code<span class=\"token operator\">=</span>DIALOGFLOW_LANGUAGE_CODE<span class=\"token punctuation\">)</span>\nquery_input <span class=\"token operator\">=</span> dialogflow<span class=\"token punctuation\">.</span>types<span class=\"token punctuation\">.</span>QueryInput<span class=\"token punctuation\">(</span>text<span class=\"token operator\">=</span>text_input<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    response <span class=\"token operator\">=</span> session_client<span class=\"token punctuation\">.</span>detect_intent<span class=\"token punctuation\">(</span>session<span class=\"token operator\">=</span>session<span class=\"token punctuation\">,</span> query_input<span class=\"token operator\">=</span>query_input<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">except</span> InvalidArgument<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">raise</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Query text:\"</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span>query_result<span class=\"token punctuation\">.</span>query_text<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Detected intent:\"</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span>query_result<span class=\"token punctuation\">.</span>intent<span class=\"token punctuation\">.</span>display_name<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Detected intent confidence:\"</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span>query_result<span class=\"token punctuation\">.</span>intent_detection_confidence<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Fulfillment text:\"</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span>query_result<span class=\"token punctuation\">.</span>fulfillment_text<span class=\"token punctuation\">)</span></code></pre></div>\n<p>On obtient alors comme sortie :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Query text: Bonjour\nDetected intent: smalltalk.greetings.hello\nDetected intent confidence: <span class=\"token number\">1.0</span>\nFulfillment text: Salut à toi <span class=\"token operator\">!</span></code></pre></div>\n<p>Ça fonctionne parfaitement ! Encore une fois il ne reste plus qu’à créer une fonction correspondante et à tout connecter.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Ce projet assez simple et assez court est très intéressant pour voir comment utiliser plusieurs API dans un même projet afin de pouvoir concevoir un pseudo assistant virtuel.\nCependant on pourrait aller plus loin et j’imagine déjà les pistes suivantes :</p>\n<ul>\n<li>remplacer la synthèse vocale par des phrases que j’ai enregistré</li>\n<li>lier des actions aux réponses de la machine (ex: ouvrir Firefox etc …)</li>\n<li>trouver une solution offline pour le réaliser</li>\n<li>le connecter à d’autres applications que j’ai développées, comme par exemple : <a href=\"/projets/a-chef-in-the-fridge\">a Chef in the fridge</a> pour chercher automatiquement une recette</li>\n</ul>","frontmatter":{"date":"June 26, 2020","title":"Un chatbot vocal en python","slug":null,"tags":["python","web","api"],"layout":"post","published":true,"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwb/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAUNujUdQS8N//8QAGxABAAICAwAAAAAAAAAAAAAAAQADAiEEERP/2gAIAQEAAQUCGG4u/PBl9eBHj1d//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Bp//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/Aar/xAAaEAACAwEBAAAAAAAAAAAAAAAAAQIRMhCR/9oACAEBAAY/Au5XhGopXKjJ/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAERITFB0f/aAAgBAQABPyEp40uwdDwlrg0LUL+rP//aAAwDAQACAAMAAAAQ5A//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAEDAQE/EEmFP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QH//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExQZHw/9oACAEBAAE/EEOkzwjYKZoVF4Ii94RN0XSzZGIEPrs//9k=","aspectRatio":1.7699115044247788,"src":"/static/cea4f7468c5322f483406cd69ade1546/14b42/micro.jpg","srcSet":"/static/cea4f7468c5322f483406cd69ade1546/f836f/micro.jpg 200w,\n/static/cea4f7468c5322f483406cd69ade1546/2244e/micro.jpg 400w,\n/static/cea4f7468c5322f483406cd69ade1546/14b42/micro.jpg 800w,\n/static/cea4f7468c5322f483406cd69ade1546/47498/micro.jpg 1200w,\n/static/cea4f7468c5322f483406cd69ade1546/0e329/micro.jpg 1600w,\n/static/cea4f7468c5322f483406cd69ade1546/6a059/micro.jpg 6000w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"headings":[{"value":"Le speech to text","depth":2,"id":"le-speech-to-text"},{"value":"Le text to speech","depth":2,"id":"le-text-to-speech"},{"value":"La conversation","depth":2,"id":"la-conversation"},{"value":"Conclusion","depth":2,"id":"conclusion"}]}},"pageContext":{"slug":"2020-06-26-chatbot-vocal","previous":{"fields":{"slug":"writeups/2020-01-05-warm-up"},"frontmatter":{"tags":["writeup","break-the-code","challenge","CTF"],"title":"[BTC] Warm Up - WriteUp","date":"2020-01-05T12:00:00.000Z","slug":null,"layout":"post","published":true}},"next":{"fields":{"slug":"eportfolio/2020-06-29-creer-compte-github"},"frontmatter":{"tags":["python","web","eportfolio"],"title":"Comment créer un compte GitHub","date":"2020-06-29T12:00:00.000Z","slug":null,"layout":"post","published":true}}}},"staticQueryHashes":["3433897746","712016698","781468736"]}